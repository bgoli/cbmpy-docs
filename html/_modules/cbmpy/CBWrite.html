
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cbmpy.CBWrite &#8212; CBMPy 0.7.20 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within CBMPy 0.7.20 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cbmpy.CBWrite</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CBMPy: CBWrite module</span>
<span class="sd">=====================</span>
<span class="sd">PySCeS Constraint Based Modelling (http://cbmpy.sourceforge.net)</span>
<span class="sd">Copyright (C) 2009-2017 Brett G. Olivier, VU University Amsterdam, Amsterdam, The Netherlands</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>

<span class="sd">Author: Brett G. Olivier</span>
<span class="sd">Contact email: bgoli@users.sourceforge.net</span>
<span class="sd">Last edit: $Author: bgoli $ ($Id: CBWrite.py 648 2018-05-23 20:01:54Z bgoli $)</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># preparing for Python 3 port</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="c1">#from __future__ import unicode_literals</span>

<span class="k">if</span> <span class="s1">&#39;cDir&#39;</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">():</span>
    <span class="n">cDir</span><span class="o">=</span><span class="nb">vars</span><span class="p">()[</span><span class="s1">&#39;cDir&#39;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">cDir</span><span class="o">=</span><span class="kc">None</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">numpy</span><span class="o">,</span> <span class="nn">zipfile</span>
<span class="c1"># this is a hack that needs to be streamlined a bit</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cStringIO</span> <span class="k">as</span> <span class="nn">csio</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">io</span> <span class="k">as</span> <span class="nn">csio</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">CBTools</span><span class="p">,</span> <span class="n">CBXML</span><span class="p">,</span> <span class="n">CBDataStruct</span>


<span class="kn">from</span> <span class="nn">.CBConfig</span> <span class="k">import</span> <span class="n">__CBCONFIG__</span> <span class="k">as</span> <span class="n">__CBCONFIG__</span>
<span class="n">__DEBUG__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;VERSION&#39;</span><span class="p">]</span>

<span class="n">_HAVE_SYMPY_</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">sympy</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">7</span> <span class="ow">and</span> <span class="nb">int</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">_HAVE_SYMPY_</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">_HAVE_SYMPY_</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">sympy</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">WARNING: SymPy version 0.7.5 or newer is required for symbolic matrix support.&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">_HAVE_SYMPY_</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: SymPy import error (required for symbolic matrix support only).&#39;</span><span class="p">)</span>

<span class="n">_HAVE_XLWT_</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">xlwt</span>
    <span class="n">_HAVE_XLWT_</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: No xlwt module available, Excel spreadsheet creation disabled&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="saveModel"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.saveModel">[docs]</a><span class="k">def</span> <span class="nf">saveModel</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Saves the model to an SBML file using the lates SBML3 FBC version.</span>
<span class="sd">    </span>
<span class="sd">    - *model* the CBMPy model</span>
<span class="sd">    - *filename* the filename to write</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">writeSBML3FBCV2</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpr_from_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                    <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compress_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>\
                    <span class="n">zip_model</span><span class="o">=</span><span class="n">compress</span><span class="p">,</span> <span class="n">return_model_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="writeSBML3FBC"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSBML3FBC">[docs]</a><span class="k">def</span> <span class="nf">writeSBML3FBC</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpr_from_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                       <span class="n">add_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                       <span class="n">xoptions</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fbc_version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span> <span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;compress_bounds&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">}):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as SBML L3 FBC:</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>
<span class="sd">     - *gpr_from_annot* [default=True] if enabled will attempt to add the gene protein associations from the annotations</span>
<span class="sd">       if no gene protein association objects exist</span>
<span class="sd">     - *add_groups* [default=True] add SBML3 groups (if supported by libSBML)</span>
<span class="sd">     - *add_cbmpy_annot* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">     - *add_cobra_annot* [default=True] add COBRA &lt;notes&gt; annotation</span>
<span class="sd">     - *xoptions* extended options</span>

<span class="sd">       - *fbc_version* [default=1] write SBML3FBC using version 1 (2013) or version 2 (2015)</span>
<span class="sd">       - *validate* [default=False] validate the output SBML file</span>
<span class="sd">       - *compress_bounds* [default=False] try compress output flux bound parameters</span>
<span class="sd">       - *zip_model* [default=False] compress the model using PKZIP encoding</span>
<span class="sd">       - *return_model_string* [default=False] return the SBML XML file as a string</span>



<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sbml_level_version</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">autofix</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">return_fbc</span><span class="o">=</span><span class="kc">False</span>
    <span class="k">return</span> <span class="n">CBXML</span><span class="o">.</span><span class="n">sbml_writeSBML3FBC</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="p">,</span> <span class="n">autofix</span><span class="p">,</span> <span class="n">return_fbc</span><span class="p">,</span>\
                                    <span class="n">gpr_from_annot</span><span class="p">,</span> <span class="n">add_groups</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="p">,</span> <span class="n">xoptions</span><span class="p">)</span></div>


<div class="viewcode-block" id="writeSBML3FBCV2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSBML3FBCV2">[docs]</a><span class="k">def</span> <span class="nf">writeSBML3FBCV2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gpr_from_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_groups</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                    <span class="n">validate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compress_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zip_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_model_string</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as SBML L3 FBCv2 :</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>
<span class="sd">     - *gpr_from_annot* [default=False] if enabled will attempt to add the gene protein associations from the annotations</span>
<span class="sd">     - *add_groups* [default=True] add SBML3 groups (if supported by libSBML)</span>
<span class="sd">     - *add_cbmpy_annot* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">     - *add_cobra_annot* [default=False] add COBRA &lt;notes&gt; annotation</span>
<span class="sd">     - *validate* [default=False] validate the output SBML file</span>
<span class="sd">     - *compress_bounds* [default=True] try compress output flux bound parameters</span>
<span class="sd">     - *zip_model* [default=False] compress the model using ZIP encoding</span>
<span class="sd">     - *return_model_string* [default=False] return the SBML XML file as a string</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">xoptions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fbc_version&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span> <span class="p">:</span> <span class="n">validate</span><span class="p">,</span> <span class="s1">&#39;compress_bounds&#39;</span> <span class="p">:</span> <span class="n">compress_bounds</span><span class="p">,</span> <span class="s1">&#39;return_model_string&#39;</span> <span class="p">:</span> <span class="n">return_model_string</span><span class="p">,</span> <span class="s1">&#39;zip_model&#39;</span> <span class="p">:</span> <span class="n">zip_model</span><span class="p">}</span>
    <span class="n">sbml_level_version</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">autofix</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">return_fbc</span><span class="o">=</span><span class="kc">False</span>
    <span class="c1">#if fbc_version == 2:</span>
        <span class="c1">#add_cobra_annot = False</span>
    <span class="k">return</span> <span class="n">CBXML</span><span class="o">.</span><span class="n">sbml_writeSBML3FBC</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="p">,</span> <span class="n">autofix</span><span class="p">,</span> <span class="n">return_fbc</span><span class="p">,</span>\
                                    <span class="n">gpr_from_annot</span><span class="p">,</span> <span class="n">add_groups</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="p">,</span> <span class="n">xoptions</span><span class="p">)</span></div>


<div class="viewcode-block" id="writeCOBRASBML"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeCOBRASBML">[docs]</a><span class="k">def</span> <span class="nf">writeCOBRASBML</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as a COBRA compatible :</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *directory* [default=None] if defined it is prepended to fname</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">CBXML</span><span class="o">.</span><span class="n">sbml_writeCOBRASBML</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeSBML2FBA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSBML2FBA">[docs]</a><span class="k">def</span> <span class="nf">writeSBML2FBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes an FBA model object and writes it to file as SBML L2 with FBA annotations.</span>
<span class="sd">    Note if you want to write BiGG/FAME style annotations then you must use *sbml_level_version=(2,1)*</span>

<span class="sd">     - *fba* an fba model object</span>
<span class="sd">     - *fname* the model will be written as XML to *fname*</span>
<span class="sd">     - *sbml_level_version* [default=None] a tuple containing the SBML level and version e.g. (2,1)</span>

<span class="sd">    This is a utility wrapper for the function `CBXML.sbml_writeSBML2FBA`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CBXML</span><span class="o">.</span><span class="n">sbml_writeSBML2FBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">sbml_level_version</span><span class="p">)</span></div>


<div class="viewcode-block" id="writeSensitivitiesToCSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSensitivitiesToCSV">[docs]</a><span class="k">def</span> <span class="nf">writeSensitivitiesToCSV</span><span class="p">(</span><span class="n">sensitivities</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write out a sensitivity report using the objective sensitivities and</span>
<span class="sd">    bound sensitivity dictionaries created by e.g. cplx_getSensitivities().</span>

<span class="sd">     - *sensitivity* tuple containing</span>

<span class="sd">      - *obj_sens* dictionary of objective coefficient sensitivities (per flux)</span>
<span class="sd">      - *rhs_sens* dictionary of constraint rhs sensitivities (per constraint)</span>
<span class="sd">      - *bound_sens* dictionary of bound sensitivities (per flux)</span>

<span class="sd">     - *fname* output filename e.g. fname.csv</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obj_sens</span> <span class="o">=</span> <span class="n">sensitivities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rhs_sens</span> <span class="o">=</span> <span class="n">sensitivities</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">bound_sens</span> <span class="o">=</span> <span class="n">sensitivities</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;_flux_sensitivity.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">head</span> <span class="o">=</span> <span class="s2">&quot;Flux,Reduced cost,OCS low,OC value,OCS high,LB low,LB high,UB low,UB high&quot;</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">head</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">obj_sens</span><span class="p">:</span>
        <span class="n">rc</span> <span class="o">=</span> <span class="n">obj_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">lcs</span> <span class="o">=</span> <span class="n">obj_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ocv</span> <span class="o">=</span> <span class="n">obj_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ucs</span> <span class="o">=</span> <span class="n">obj_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bound_sens</span><span class="p">:</span>
            <span class="n">lbs</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ubs</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbs</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ubs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">rc</span><span class="p">,</span><span class="n">lcs</span><span class="p">,</span><span class="n">ocv</span><span class="p">,</span><span class="n">ucs</span><span class="p">,</span><span class="n">lbs</span><span class="p">,</span><span class="n">lb</span><span class="p">,</span><span class="n">ub</span><span class="p">,</span><span class="n">ubs</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">bound_sens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">j</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">obj_sens</span><span class="p">:</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lcs</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ocv</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ucs</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">lbs</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ubs</span> <span class="o">=</span> <span class="n">bound_sens</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">rc</span><span class="p">,</span><span class="n">lcs</span><span class="p">,</span><span class="n">ocv</span><span class="p">,</span><span class="n">ucs</span><span class="p">,</span><span class="n">lbs</span><span class="p">,</span><span class="n">lb</span><span class="p">,</span><span class="n">ub</span><span class="p">,</span><span class="n">ubs</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;_constraint_sensitivity.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Constraint,RHS low,RHS,RHS high</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rhs_sens</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">rhs_sens</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">rhs_sens</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">rhs_sens</span><span class="p">[</span><span class="n">c</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="WriteModelRaw"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteModelRaw">[docs]</a><span class="k">def</span> <span class="nf">WriteModelRaw</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">cDir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeModelRaw()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeModelRaw()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeModelRaw</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeModelRaw"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelRaw">[docs]</a><span class="k">def</span> <span class="nf">writeModelRaw</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">cDir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a fba (actually just dumps it) to a text file.</span>

<span class="sd">     - *fba* an instantiated FBAmodel instance</span>
<span class="sd">     - *work_dir* directory designated for output</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span><span class="s1">&#39;WriteModelRawOutput.txt&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Species information:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: value=</span><span class="si">%f</span><span class="s1">, is_boundary=</span><span class="si">%s</span><span class="s1">, name=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">),</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Reaction information:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: reversible=</span><span class="si">%s</span><span class="s1">, name=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">reversible</span><span class="p">),</span> <span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">r</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">())</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Constraint information:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Objective information:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Active Objective: </span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">o</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">o</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()))</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Stoichiometric information:</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;N-matrix dimensions = (</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WriteModelRaw has written a file to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span><span class="s1">&#39;WriteModelRawOutput.txt&#39;</span><span class="p">)))</span></div>

<div class="viewcode-block" id="BuildLPFluxBounds"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPFluxBounds">[docs]</a><span class="k">def</span> <span class="nf">BuildLPFluxBounds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains the flux bounds in LP format</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">c2s</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span><span class="p">))</span>
        <span class="n">minv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">maxv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">oper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;less&#39;</span><span class="p">,</span><span class="s1">&#39;lessEqual&#39;</span><span class="p">]:</span>
            <span class="n">maxv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span>
            <span class="k">if</span> <span class="n">oper</span> <span class="o">==</span> <span class="s1">&#39;less&#39;</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP Bounds operator must be &lt;= not &lt;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span><span class="s1">&#39;greaterEqual&#39;</span><span class="p">]:</span>
            <span class="n">minv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span>
            <span class="k">if</span> <span class="n">oper</span> <span class="o">==</span> <span class="s1">&#39;greater&#39;</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP Bounds operator must be &lt;= not &lt;&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;equals&#39;</span><span class="p">:</span>
            <span class="n">maxv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>
        <span class="k">if</span> <span class="n">maxv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">c2s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">maxv</span><span class="p">))})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">maxv</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">):</span>
                    <span class="n">c2s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> +</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">maxv</span><span class="p">)})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">c2s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">oper</span><span class="p">,</span> <span class="n">maxv</span><span class="p">)})</span>
        <span class="k">elif</span> <span class="n">minv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">c2s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;l&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">minv</span><span class="p">),</span> <span class="n">oper</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">c2s</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;l&#39;</span> <span class="p">:</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">minv</span><span class="p">,</span> <span class="n">oper</span><span class="p">)})</span>

    <span class="n">c2sk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">c2s</span><span class="p">)</span>
    <span class="n">c2sk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="p">(</span><span class="n">c2sk</span><span class="p">):</span>
        <span class="n">rht</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">lht</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">r</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span> <span class="ow">in</span> <span class="n">c2s</span><span class="p">:</span>
            <span class="n">rht</span> <span class="o">=</span> <span class="n">c2s</span><span class="p">[</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
            <span class="n">c2s</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">R</span><span class="o">+</span><span class="s1">&#39;l&#39;</span> <span class="ow">in</span> <span class="n">c2s</span><span class="p">:</span>
            <span class="n">lht</span> <span class="o">=</span> <span class="n">c2s</span><span class="p">[</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;l&#39;</span><span class="p">]</span>
            <span class="n">c2s</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">R</span><span class="o">+</span><span class="s1">&#39;l&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lht</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rht</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span>
            <span class="c1">##  FFS.write(&#39;%s: %s %s %s\n&#39; % (R, lht, R, rht))</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span> <span class="c1"># THIS MUST BE SO for GLPK</span>
        <span class="k">elif</span> <span class="n">lht</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rht</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping: (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">lht</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
            <span class="c1">#FFS.write(&#39;%s: %s %s\n&#39; % (R, lht, R))</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">rht</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span>
            <span class="c1">#FFS.write(&#39;%s: %s %s\n&#39; % (R, R, rht))</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CONFUSION: (</span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lht</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">rht</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">FFS</span></div>

<div class="viewcode-block" id="BuildLPConstraints"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPConstraints">[docs]</a><span class="k">def</span> <span class="nf">BuildLPConstraints</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains constraint constructed from</span>
<span class="sd">    the StoichiometeryLP object</span>

<span class="sd">     - *fba* an fba model object which has a stoichiometry</span>
<span class="sd">     - *use_rational* write rational number output [default=False]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational output&#39;</span><span class="p">)</span>
    <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">])</span> <span class="o">!=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">)</span> <span class="o">!=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">rebuild_stoich</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning FBA object has inconsistant stoichiometric matrix, rebuilding it now.&#39;</span><span class="p">)</span>
        <span class="n">CBTools</span><span class="o">.</span><span class="n">addStoichToFBAModel</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>

    <span class="n">constr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rowName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">RCon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">colName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">colCoef</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colCoef</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">RCon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colCoef</span><span class="p">,</span> <span class="n">colName</span><span class="p">))</span>
        <span class="n">constr</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rowName</span> <span class="p">:</span> <span class="n">RCon</span><span class="p">})</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">constrsk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="n">constrsk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="c1">##  for r in constrsk:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="c1">##  FFS.write(&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+ </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;- </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">operator</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">operators</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;&gt;=&#39;</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INVALID operator: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">operator</span><span class="p">)</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">operator</span><span class="p">)</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">RHS</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">FFS</span></div>

<div class="viewcode-block" id="BuildLPUserConstraints"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPUserConstraints">[docs]</a><span class="k">def</span> <span class="nf">BuildLPUserConstraints</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains constraint constructed from</span>
<span class="sd">    the StoichiometeryLP object</span>

<span class="sd">     - *fba* an fba model object which has a stoichiometry</span>
<span class="sd">     - *use_rational* write rational number output [default=False]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational output&#39;</span><span class="p">)</span>
    <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">assert</span> <span class="n">fba</span><span class="o">.</span><span class="n">user_constraints</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No user constraints to build&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span><span class="s1">&#39;CM&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rebuild_stoich</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">rebuild_stoich</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning FBA object has inconsistant user constraint matrix, rebuilding it now.&#39;</span><span class="p">)</span>
        <span class="n">CBTools</span><span class="o">.</span><span class="n">addStoichToFBAModel</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>

    <span class="n">constr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rowName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">RCon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">colName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">colCoef</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colCoef</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">RCon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colCoef</span><span class="p">,</span> <span class="n">colName</span><span class="p">))</span>
        <span class="n">constr</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rowName</span> <span class="p">:</span> <span class="n">RCon</span><span class="p">})</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">constrsk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="n">constrsk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="c1">##  for r in constrsk:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">row</span><span class="p">)):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
            <span class="c1">##  FFS.write(&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]]:</span>
                <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+ </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;- </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">operator</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">operators</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;&gt;=&#39;</span>
            <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;&#39;</span> <span class="ow">or</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">:</span>
                <span class="n">operator</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INVALID operator: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">operator</span><span class="p">)</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">operator</span><span class="p">)</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">RHS</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">FFS</span></div>


<div class="viewcode-block" id="BuildLPConstraintsRelaxed"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPConstraintsRelaxed">[docs]</a><span class="k">def</span> <span class="nf">BuildLPConstraintsRelaxed</span><span class="p">(</span><span class="n">fba</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains the constaints in LP format</span>
<span class="sd">    Relaxed refers to dS/dt &gt;= 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This method is deprecated&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning FBA object has no stoichiometric matrix constructing it now.&#39;</span><span class="p">)</span>
        <span class="n">CBTools</span><span class="o">.</span><span class="n">addStoichToFBAModel</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">constr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rowName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">RCon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">colName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">colCoef</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colCoef</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">RCon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colCoef</span><span class="p">,</span> <span class="n">colName</span><span class="p">))</span>
        <span class="n">constr</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rowName</span> <span class="p">:</span> <span class="n">RCon</span><span class="p">})</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">constrsk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="n">constrsk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="c1">##  FFS.write(&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">FFS</span></div>

<div class="viewcode-block" id="BuildLPConstraintsStrict"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPConstraintsStrict">[docs]</a><span class="k">def</span> <span class="nf">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains the constaints in LP format</span>
<span class="sd">    Strict refers to dS/dt = 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">##  print &quot;Consider using the new BuildLPConstraints() method&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning FBA object has no stoichiometric matrix constructing it now.&#39;</span><span class="p">)</span>
        <span class="n">CBTools</span><span class="o">.</span><span class="n">addStoichToFBAModel</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">constr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rowName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">RCon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">colName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">colCoef</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colCoef</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">RCon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colCoef</span><span class="p">,</span> <span class="n">colName</span><span class="p">))</span>
        <span class="n">constr</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rowName</span> <span class="p">:</span> <span class="n">RCon</span><span class="p">})</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">constrsk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="n">constrsk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="c1">##  for r in constrsk:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: &#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="c1">##  FFS.write(&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+ </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;- </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.20f</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;= 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">FFS</span></div>

<div class="viewcode-block" id="BuildLPConstraintsMath"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildLPConstraintsMath">[docs]</a><span class="k">def</span> <span class="nf">BuildLPConstraintsMath</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains the constaints in LP format</span>
<span class="sd">    Strict refers to dS/dt =&gt; 0 and dS/dt &lt;= 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This method is deprecated&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning FBA object has no stoichiometric matrix constructing it now.&#39;</span><span class="p">)</span>
        <span class="n">CBTools</span><span class="o">.</span><span class="n">addStoichToFBAModel</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">constr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">rowName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="n">RCon</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">colName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]</span>
            <span class="n">colCoef</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">colCoef</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">RCon</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">colCoef</span><span class="p">,</span> <span class="n">colName</span><span class="p">))</span>
        <span class="n">constr</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">rowName</span> <span class="p">:</span> <span class="n">RCon</span><span class="p">})</span>

    <span class="n">FFS</span> <span class="o">=</span> <span class="n">csio</span><span class="o">.</span><span class="n">StringIO</span><span class="p">()</span>
    <span class="n">constrsk</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
    <span class="n">constrsk</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">n1: &#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="c1">##  FFS.write(&#39; &#39;)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># This is a fudge</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">n2: &#39;</span> <span class="o">%</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">constr</span><span class="p">[</span><span class="n">r</span><span class="p">]:</span>
                <span class="k">if</span> <span class="o">-</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;+</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="o">-</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># This is a fudge</span>
            <span class="n">FFS</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FFS</span></div>

<div class="viewcode-block" id="WriteModelLPOld"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteModelLPOld">[docs]</a><span class="k">def</span> <span class="nf">WriteModelLPOld</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multisymb</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">lpt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeModelLPOld()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeModelLPOld()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeModelLPOld</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">multisymb</span><span class="p">,</span> <span class="n">lpt</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeModelLPOld"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelLPOld">[docs]</a><span class="k">def</span> <span class="nf">writeModelLPOld</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multisymb</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">lpt</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a fba as an LP/LPT</span>

<span class="sd">     - *fba* an instantiated FBAmodel instance</span>
<span class="sd">     - *work_dir* directory designated for output</span>
<span class="sd">     - *multisymb* the multiplication symbol (default: &lt;space&gt;)</span>
<span class="sd">     - *lpt* the file format (default: True for lpt) or False for lp</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">THIS FUNCTION IS DEPRECATED</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>

    <span class="n">FNAME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">FnameTmp</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">FnameTmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">FnameTmp</span> <span class="o">=</span> <span class="n">FnameTmp</span><span class="o">+</span><span class="s1">&#39;.rat&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">lpt</span><span class="p">:</span>
        <span class="n">FNAME</span> <span class="o">=</span> <span class="n">FnameTmp</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span>
        <span class="n">FF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">FNAME</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Problem</span><span class="se">\n</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">FnameTmp</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">FNAME</span> <span class="o">=</span> <span class="n">FnameTmp</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span>
        <span class="n">FF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">FNAME</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">FnameTmp</span><span class="p">)</span>
    <span class="n">objO</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="n">objO</span> <span class="o">=</span> <span class="n">objO</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">objO</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">objO</span><span class="p">)</span>
    <span class="n">objStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_objf: &#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">fObj</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">:</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Suspected rational number (</span><span class="si">{}</span><span class="s1">) detected in fluxObjective </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
        <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
        <span class="c1"># TODO: if use_rational is not used simply try and evaluate the coefficient string with</span>
        <span class="c1"># sympy.Rational.evalf()  and use this as the value for nc ... also remove use_rational case</span>
        <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
            <span class="n">objStr</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">),</span> <span class="n">multisymb</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">reaction</span><span class="p">)</span>
            <span class="c1">##  FF.write(&#39;%s: %s%s%s\n&#39; % (fobj0.reaction, sympy.Rational(fobj0.coefficient), multisymb, fobj0.reaction))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">objStr</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="n">multisymb</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">reaction</span><span class="p">)</span>
            <span class="c1">##  FF.write(&#39;%s: %s%s%s\n&#39; % (fobj0.reaction, fobj0.coefficient, multisymb, fobj0.reaction))</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">objStr</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;math&#39;</span><span class="p">:</span>
        <span class="n">CONST</span> <span class="o">=</span> <span class="n">BuildLPConstraintsMath</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;relaxed&#39;</span><span class="p">:</span>
        <span class="n">CONST</span> <span class="o">=</span> <span class="n">BuildLPConstraintsRelaxed</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">CONST</span> <span class="o">=</span> <span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">)</span>

    <span class="n">CONST</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">BOUNDS</span> <span class="o">=</span> <span class="n">BuildLPFluxBounds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">)</span>
    <span class="n">BOUNDS</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">CONST</span><span class="o">.</span><span class="n">read</span><span class="p">());</span> <span class="n">CONST</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">BOUNDS</span><span class="o">.</span><span class="n">read</span><span class="p">());</span> <span class="n">BOUNDS</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Subject To</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONST</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bounds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">BOUNDS</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">END</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writeModelLP has written a file to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">NAME</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">FNAME</span></div>

<div class="viewcode-block" id="WriteModelLP"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteModelLP">[docs]</a><span class="k">def</span> <span class="nf">WriteModelLP</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multisymb</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeModelLP()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeModelLP()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeModelLP</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">multisymb</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="p">,</span> <span class="n">quiet</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeModelLP"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelLP">[docs]</a><span class="k">def</span> <span class="nf">writeModelLP</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multisymb</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes an FBA object as an LP in CPLEX LP format</span>

<span class="sd">     - *fba* an instantiated FBAmodel instance</span>
<span class="sd">     - *work_dir* directory designated for output</span>
<span class="sd">     - *fname* the file name [default=fba.getId()]</span>
<span class="sd">     - *multisymb* the multiplication symbol (default: &lt;space&gt;)</span>
<span class="sd">     - *format* the number format of the output</span>
<span class="sd">     - *use_rational* output rational numbers [default=False]</span>
<span class="sd">     - *quiet* [default=False] supress information messages</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">constraint_mode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Constraint_mode has been deprecated&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Warning switching to floating point arithmetic: install Sympy for rational IO&#39;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">FNAME</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">FnameTmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span>  <span class="n">fname</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">FnameTmp</span> <span class="o">=</span> <span class="n">fname</span>

    <span class="n">FNAME</span> <span class="o">=</span> <span class="n">FnameTmp</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">FNAME</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">FnameTmp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">##  print fba.objectives</span>
        <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">WARNING: Objective function </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> has no </span><span class="se">\&quot;</span><span class="s1">operation</span><span class="se">\&quot;</span><span class="s1"> defined assuming </span><span class="se">\&quot;</span><span class="s1">maximize</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">objO</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">objO</span> <span class="o">=</span> <span class="n">objO</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="n">objO</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">objO</span><span class="p">)</span>
        <span class="n">objStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_objf: &#39;</span> <span class="o">%</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">fObj</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_HAVE_SYMPY_</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span><span class="o">.</span><span class="n">evalf</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">ValuError</span><span class="p">(</span> <span class="s1">&#39;Invalid coefficient (</span><span class="si">%s</span><span class="s1">) detected in fluxObjective </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fObj</span><span class="o">.</span><span class="n">coefficient</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">nc</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sign</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
            <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">objStr</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">nc</span><span class="p">)),</span> <span class="n">multisymb</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">reaction</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">objStr</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">nc</span><span class="p">),</span> <span class="n">multisymb</span><span class="p">,</span> <span class="n">fObj</span><span class="o">.</span><span class="n">reaction</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">objStr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\\\\</span><span class="s1"> No objectives defined</span><span class="se">\n\n</span><span class="s1">&#39;</span>

    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">objStr</span><span class="p">)</span>
    <span class="n">CONST</span> <span class="o">=</span> <span class="n">BuildLPConstraints</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">)</span>
    <span class="n">CONST</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">user_constraints</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">user_constraints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">UCONST</span> <span class="o">=</span> <span class="n">BuildLPUserConstraints</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">UCONST</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">BOUNDS</span> <span class="o">=</span> <span class="n">BuildLPFluxBounds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">)</span>
    <span class="n">BOUNDS</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">CONST</span><span class="o">.</span><span class="n">read</span><span class="p">());</span> <span class="n">CONST</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">BOUNDS</span><span class="o">.</span><span class="n">read</span><span class="p">());</span> <span class="n">BOUNDS</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Subject To</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONST</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">user_constraints</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">user_constraints</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">UserConstraints</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">UCONST</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bounds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">BOUNDS</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">END</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">FF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;writeModelLP has written a file to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">FNAME</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">FNAME</span></div>

<div class="viewcode-block" id="BuildHformatFluxBounds"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.BuildHformatFluxBounds">[docs]</a><span class="k">def</span> <span class="nf">BuildHformatFluxBounds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build and return a csio that contains the flux bounds in H format</span>

<span class="sd">     - *fba* a PySCeS-CBM FBA object</span>
<span class="sd">     - *infinity_replace* [default=None] if defined this is the abs(value) of +-&lt;infinity&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LBs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">UBs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="c1">##  print &#39;%s: %s&#39; % (c.getId(), c.operation)</span>
        <span class="n">minv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">maxv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">oper</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;less&#39;</span><span class="p">,</span><span class="s1">&#39;lessEqual&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isposinf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="n">infinity_replace</span>
            <span class="k">elif</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isneginf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity_replace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="c1">##  print &#39;maxv&#39;, maxv</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span>
            <span class="k">if</span> <span class="n">oper</span> <span class="o">==</span> <span class="s1">&#39;less&#39;</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
                <span class="c1">##  print &#39;LP Bounds operator must be &lt;= not &lt;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span><span class="s1">&#39;greaterEqual&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isposinf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">minv</span> <span class="o">=</span> <span class="n">infinity_replace</span>
            <span class="k">elif</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isneginf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">minv</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity_replace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">minv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="c1">##  print &#39;minv&#39;, minv</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span>
            <span class="k">if</span> <span class="n">oper</span> <span class="o">==</span> <span class="s1">&#39;greater&#39;</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
                <span class="c1">##  print &#39;LP Bounds operator must be &lt;= not &lt;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;&lt;=&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span> <span class="o">==</span> <span class="s1">&#39;equals&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isposinf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="n">infinity_replace</span>
            <span class="k">elif</span> <span class="n">infinity_replace</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isneginf</span><span class="p">([</span><span class="n">c</span><span class="o">.</span><span class="n">value</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="o">-</span><span class="n">infinity_replace</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">maxv</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
            <span class="n">oper</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span>
            <span class="c1">##  print &#39;maxv2&#39;, maxv</span>
        <span class="k">if</span> <span class="n">maxv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">UBs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">maxv</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">UBs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span> <span class="p">:</span> <span class="n">maxv</span><span class="p">})</span>

        <span class="k">elif</span> <span class="n">minv</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">LBs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span> <span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">minv</span><span class="p">)})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">LBs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">R</span> <span class="p">:</span> <span class="n">minv</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LBs</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">UBs</span><span class="p">)</span>

    <span class="n">BsRHS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">LBm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">LBs</span><span class="p">),</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">UBm</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">UBs</span><span class="p">),</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_HAVE_SYMPY_</span><span class="p">:</span>
            <span class="n">LBm</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LBs</span><span class="p">),</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">UBm</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">UBs</span><span class="p">),</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Using rational bounds&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error: SymPy required for rational operations&#39;</span><span class="p">)</span>


    <span class="n">LBskeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">LBs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">lb</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">LBskeys</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
            <span class="n">LBm</span><span class="p">[</span><span class="n">lb</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">LBskeys</span><span class="p">[</span><span class="n">lb</span><span class="p">])]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">BsRHS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LBs</span><span class="p">[</span><span class="n">LBskeys</span><span class="p">[</span><span class="n">lb</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LBm</span><span class="p">[</span><span class="n">lb</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">LBskeys</span><span class="p">[</span><span class="n">lb</span><span class="p">])]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;SYMPY_DENOM_LIMIT&#39;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">LBs</span><span class="p">[</span><span class="n">LBskeys</span><span class="p">[</span><span class="n">lb</span><span class="p">]])</span>
            <span class="n">BsRHS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">LBs</span><span class="p">[</span><span class="n">LBskeys</span><span class="p">[</span><span class="n">lb</span><span class="p">]])</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;SYMPY_DENOM_LIMIT&#39;</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LBm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">UBm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsRHS</span><span class="p">)</span>

    <span class="n">UBskeys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">UBs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ub</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">UBskeys</span><span class="p">)):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
            <span class="n">UBm</span><span class="p">[</span><span class="n">ub</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">UBskeys</span><span class="p">[</span><span class="n">ub</span><span class="p">])]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="n">BsRHS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">UBs</span><span class="p">[</span><span class="n">UBskeys</span><span class="p">[</span><span class="n">ub</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">UBm</span><span class="p">[</span><span class="n">ub</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">UBskeys</span><span class="p">[</span><span class="n">ub</span><span class="p">])]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;SYMPY_DENOM_LIMIT&#39;</span><span class="p">])</span>
            <span class="n">BsRHS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">UBs</span><span class="p">[</span><span class="n">UBskeys</span><span class="p">[</span><span class="n">ub</span><span class="p">]])</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;SYMPY_DENOM_LIMIT&#39;</span><span class="p">]))</span>

    <span class="k">del</span> <span class="n">LBskeys</span><span class="p">,</span> <span class="n">UBskeys</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LBm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">UBm</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsRHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">LBm</span><span class="p">,</span> <span class="n">UBm</span><span class="p">]),</span> <span class="n">BsRHS</span></div>

<div class="viewcode-block" id="WriteModelHFormatFBA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteModelHFormatFBA">[docs]</a><span class="k">def</span> <span class="nf">WriteModelHFormatFBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullLP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeModelHFormatFBA2()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeModelHFormatFBA2()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeModelHFormatFBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">,</span> <span class="n">fullLP</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeModelHFormatFBA"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelHFormatFBA">[docs]</a><span class="k">def</span> <span class="nf">writeModelHFormatFBA</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullLP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write an FBA-LP in polynomial H-Format file. This version has been replaced by `writeModelHFormatFBA2()`</span>
<span class="sd">    but is kept for backwards compatability.</span>

<span class="sd">     - *fba* a PySCeS-CBM FBA object</span>
<span class="sd">     - *Work_dir* [default=None] the output directory</span>
<span class="sd">     - *use_rational* [default=false] use rational numbers in output (requires sympy)</span>
<span class="sd">     - *fullLP* [default=True] include the default objective function as a maximization target</span>
<span class="sd">     - *format* [default=&#39;%s&#39;] the number format string</span>
<span class="sd">     - *infinity_replace* [default=None] if defined this is the abs(value) of +-&lt;infinity&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">writeModelHFormatFBA is deprecated please use: writeModelHFormatFBA2</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">fba</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">RHS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">LHS</span><span class="p">,</span> <span class="o">-</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()])</span>
    <span class="n">RHS</span> <span class="o">+=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="n">BsLHS</span><span class="p">,</span> <span class="n">BsRHS</span> <span class="o">=</span> <span class="n">BuildHformatFluxBounds</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="n">infinity_replace</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsLHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsRHS</span><span class="p">)</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">LHS</span><span class="p">,</span> <span class="n">BsLHS</span><span class="p">])</span>
    <span class="n">RHS</span> <span class="o">+=</span> <span class="n">BsRHS</span>
    <span class="k">del</span> <span class="n">BsLHS</span><span class="p">,</span> <span class="n">BsRHS</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.ine&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_r.ine&#39;</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">RHS</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">)</span>
    <span class="n">RHS</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RHS</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="c1">##  LP = numpy.hstack([LHS, RHS])</span>

    <span class="n">OBJ_FUNC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">LHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># first objective function, first flux objective</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">OBJ_FUNC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">OBJ_FUNC</span><span class="p">)</span>

    <span class="c1"># for Ax &gt;= B Hformat wants -B A &gt;= 0</span>
    <span class="n">LP</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">RHS</span><span class="p">,</span> <span class="n">LHS</span><span class="p">])</span>
    <span class="n">OBJ_FUNC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">OBJ_FUNC</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">OBJ_FUNC</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">OBJ_FUNC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LP</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">LHS</span><span class="p">,</span> <span class="n">RHS</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Fname</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Janee ...&#39;</span>
        <span class="n">Fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;* </span><span class="si">%s</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;H-representation</span><span class="se">\n\n</span><span class="s1">begin</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">NUM_TYPE</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
    <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">NUM_TYPE</span> <span class="o">=</span> <span class="s1">&#39;rational&#39;</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  </span><span class="si">%s</span><span class="s1">  </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">NUM_TYPE</span><span class="p">))</span>

    <span class="n">strW</span> <span class="o">=</span> <span class="nb">format</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strW</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]))</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fullLP</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">lponly</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;maximize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">OBJ_FUNC</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strW</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">o</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ine&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.columns.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Fname</span></div>

<div class="viewcode-block" id="WriteModelHFormatFBA2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteModelHFormatFBA2">[docs]</a><span class="k">def</span> <span class="nf">WriteModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullLP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeModelHFormatFBA2()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeModelHFormatFBA2()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">use_rational</span><span class="p">,</span> <span class="n">fullLP</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeModelHFormatFBA2"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelHFormatFBA2">[docs]</a><span class="k">def</span> <span class="nf">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullLP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write an FBA-LP in polynomial H-Format file. This is an improved version of `WriteModelHFormatFBA()`</span>
<span class="sd">    which it replaces. Note that if a SymPy matrix is used as input then use_rational is automatically enabled.</span>

<span class="sd">     - *fba* a PySCeS-CBM FBA object</span>
<span class="sd">     - *fname* [default=None] the output filename, fba.getId() if not defined</span>
<span class="sd">     - *Work_dir* [default=None] the output directory</span>
<span class="sd">     - *use_rational* [default=false] use rational numbers in output (requires sympy)</span>
<span class="sd">     - *fullLP* [default=True] include the default objective function as a maximization target</span>
<span class="sd">     - *format* [default=&#39;%s&#39;] the number format string</span>
<span class="sd">     - *infinity_replace* [default=None] if defined this is the abs(value) of +-&lt;infinity&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">use_rational_old</span> <span class="o">=</span> <span class="n">use_rational</span>
    <span class="k">if</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">fba</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">__array_type__</span> <span class="o">==</span> <span class="n">sympy</span><span class="o">.</span><span class="n">MutableDenseMatrix</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: using rational matrix&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">fba</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1">#RHS = [0.0 for e in range(M.N.shape[0])]</span>
    <span class="n">RHS</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">RHS</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">LHS</span><span class="p">,</span> <span class="o">-</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()])</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">RHS</span>
    <span class="n">RHS</span> <span class="o">+=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">tmp</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="n">BsLHS</span><span class="p">,</span> <span class="n">BsRHS</span> <span class="o">=</span> <span class="n">BuildHformatFluxBounds</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="n">infinity_replace</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="n">use_rational</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">BsLHS</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">(</span><span class="n">BsLHS</span><span class="p">)</span>
        <span class="n">den_lim</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;SYMPY_DENOM_LIMIT&#39;</span><span class="p">]</span>
        <span class="n">BsRHS</span> <span class="o">=</span> <span class="p">[</span><span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">den_lim</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">BsRHS</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BsLHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">BsLHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">BsLHS</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="n">BsLHS</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span><span class="o">.</span><span class="n">limit_denominator</span><span class="p">(</span><span class="n">den_lim</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsLHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsRHS</span><span class="p">)</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">LHS</span><span class="p">,</span> <span class="n">BsLHS</span><span class="p">])</span>
    <span class="n">RHS</span> <span class="o">+=</span> <span class="n">BsRHS</span>
    <span class="k">del</span> <span class="n">BsLHS</span><span class="p">,</span> <span class="n">BsRHS</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>

    <span class="n">RHS</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="n">RHS</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RHS</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="c1">##  LP = numpy.hstack([LHS, RHS])</span>

    <span class="n">OBJ_FUNC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">LHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">objIdx</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">activeObjIdx</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LHS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">())):</span>
            <span class="k">if</span> <span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="n">fo</span><span class="p">]</span><span class="o">.</span><span class="n">reaction</span> <span class="o">==</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="n">fo</span><span class="p">]</span><span class="o">.</span><span class="n">reaction</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                <span class="n">OBJ_FUNC</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">objIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="n">fo</span><span class="p">]</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span>
    <span class="c1">##  print OBJ_FUNC</span>

    <span class="c1"># for Ax &gt;= B Hformat wants -B A &gt;= 0</span>
    <span class="n">LP</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">RHS</span><span class="p">,</span> <span class="n">LHS</span><span class="p">])</span>
    <span class="n">OBJ_FUNC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">OBJ_FUNC</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">OBJ_FUNC</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">OBJ_FUNC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LP</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">LHS</span><span class="p">,</span> <span class="n">RHS</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Janee ...&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.ine&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_r.ine&#39;</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;* </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;H-representation</span><span class="se">\n</span><span class="s1">begin</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">NUM_TYPE</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
    <span class="k">if</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">NUM_TYPE</span> <span class="o">=</span> <span class="s1">&#39;rational&#39;</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">  </span><span class="si">%s</span><span class="s1">  </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">NUM_TYPE</span><span class="p">))</span>

    <span class="n">strW</span> <span class="o">=</span> <span class="nb">format</span><span class="o">+</span><span class="s1">&#39; &#39;</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">use_rational</span> <span class="ow">or</span> <span class="n">use_rational_old</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strW</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fullLP</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">lponly</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;maximize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># check if Hformat has a minimize kw</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">OBJ_FUNC</span><span class="p">:</span>
            <span class="c1">#if not use_rational:</span>
                <span class="c1">#F.write(strW % o)</span>
            <span class="c1">#else:</span>
                <span class="c1">#F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>

            <span class="k">if</span> <span class="n">use_rational</span> <span class="ow">or</span> <span class="n">use_rational_old</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">o</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">o</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strW</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>

        <span class="c1"># then we can use use this</span>
        <span class="c1">##  F.write(&#39;%s\n&#39; % M.objectives[M.activeObjIdx].operation)</span>
        <span class="c1">##  if M.activeObjIdx].operation == &#39;maximize&#39;:</span>
            <span class="c1">##  for o in OBJ_FUNC:</span>
                <span class="c1">##  if not use_rational:</span>
                    <span class="c1">##  F.write(strW % o)</span>
                <span class="c1">##  else:</span>
                    <span class="c1">##  F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>
        <span class="c1">##  else:</span>
            <span class="c1">##  for o in OBJ_FUNC:</span>
                <span class="c1">##  o = -o</span>
                <span class="c1">##  if not use_rational:</span>
                    <span class="c1">##  F.write(strW % o)</span>
                <span class="c1">##  else:</span>
                    <span class="c1">##  F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ine&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.columns.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fname</span></div>


<div class="viewcode-block" id="writeStoichiometricMatrix"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeStoichiometricMatrix">[docs]</a><span class="k">def</span> <span class="nf">writeStoichiometricMatrix</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fullLP</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">infinity_replace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write an FBA-LP in polynomial H-Format file. This is an improved version of `WriteModelHFormatFBA()`</span>
<span class="sd">    which it replaces but is kept for backwards compatability.</span>

<span class="sd">     - *fba* a PySCeS-CBM FBA object</span>
<span class="sd">     - *fname* [default=None] the output filename, fba.getId() if not defined</span>
<span class="sd">     - *Work_dir* [default=None] the output directory</span>
<span class="sd">     - *use_rational* [default=false] use rational numbers in output (requires sympy)</span>
<span class="sd">     - *fullLP* [default=True] include the default objective function as a maximization target</span>
<span class="sd">     - *format* [default=&#39;%s&#39;] the number format string</span>
<span class="sd">     - *infinity_replace* [default=None] if defined this is the abs(value) of +-&lt;infinity&gt;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_SYMPY_</span> <span class="ow">and</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">use_rational</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: install Sympy for rational IO&#39;</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">fba</span>
    <span class="n">LHS</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">RHS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="c1">#LHS = numpy.vstack([LHS, -M.N.array.copy()])</span>
    <span class="n">RHS</span> <span class="o">+=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="c1">#BsLHS, BsRHS = BuildHformatFluxBounds(M, infinity_replace=infinity_replace)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsLHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">BsRHS</span><span class="p">)</span>
    <span class="c1">#LHS = numpy.vstack([LHS, BsLHS])</span>
    <span class="c1">#RHS += BsRHS</span>
    <span class="c1">#del BsLHS, BsRHS</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LHS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>

    <span class="c1">#RHS = numpy.array(RHS,&#39;d&#39;)</span>
    <span class="c1">#RHS.shape = (len(RHS), 1)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">RHS</span><span class="p">)</span>
    <span class="c1">##  LP = numpy.hstack([LHS, RHS])</span>

    <span class="c1">#OBJ_FUNC = numpy.zeros(LHS.shape[1]+1)</span>
    <span class="n">objIdx</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">activeObjIdx</span>
    <span class="c1">#for j in range(LHS.shape[1]):</span>
        <span class="c1">#for fo in range(len(M.objectives[objIdx].getFluxObjectiveReactions())):</span>
            <span class="c1">#if M.objectives[objIdx].fluxObjectives[fo].reaction == M.N.col[j]:</span>
                <span class="c1">#print(M.objectives[objIdx].fluxObjectives[fo].reaction, M.N.col[j])</span>
                <span class="c1">#OBJ_FUNC[j] = float(M.objectives[objIdx].fluxObjectives[fo].coefficient)</span>
    <span class="c1">###  print OBJ_FUNC</span>

    <span class="c1"># for Ax &gt;= B Hformat wants -B A &gt;= 0</span>
    <span class="c1">#LP = numpy.hstack([-RHS, LHS])</span>
    <span class="c1">#OBJ_FUNC = numpy.hstack([-OBJ_FUNC[-1], OBJ_FUNC[:-1]])</span>

    <span class="n">LP</span> <span class="o">=</span> <span class="n">LHS</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">OBJ_FUNC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">LP</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">LHS</span><span class="p">,</span> <span class="n">RHS</span>

    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Janee ...&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.ine&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;_r.ine&#39;</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#F.write(&#39;* %s\n&#39; % os.path.split(fname)[-1])</span>
    <span class="c1">#F.write(&#39;H-representation\nbegin\n&#39;)</span>
    <span class="c1">#NUM_TYPE = &#39;real&#39;</span>
    <span class="c1">#if use_rational:</span>
        <span class="c1">#NUM_TYPE = &#39;rational&#39;</span>
    <span class="c1">#F.write(&#39;%s  %s  %s\n&#39; % (LP.shape[0], LP.shape[1], NUM_TYPE))</span>

    <span class="n">strW</span> <span class="o">=</span> <span class="nb">format</span><span class="o">+</span><span class="s1">&#39; &#39;</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LP</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">use_rational</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strW</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">##  print LP[r,c]</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Rational</span><span class="p">(</span><span class="nb">format</span> <span class="o">%</span> <span class="n">LP</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">]))</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1">#if fullLP:</span>
        <span class="c1">#F.write(&#39;end\nlponly\n&#39;)</span>
        <span class="c1">#F.write(&#39;maximize\n&#39;) # check if Hformat has a minimize kw</span>
        <span class="c1">#for o in OBJ_FUNC:</span>
            <span class="c1">#if not use_rational:</span>
                <span class="c1">#F.write(strW % o)</span>
            <span class="c1">#else:</span>
                <span class="c1">#F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>
        <span class="c1"># then we can use use this</span>
        <span class="c1">##  F.write(&#39;%s\n&#39; % M.objectives[M.activeObjIdx].operation)</span>
        <span class="c1">##  if M.activeObjIdx].operation == &#39;maximize&#39;:</span>
            <span class="c1">##  for o in OBJ_FUNC:</span>
                <span class="c1">##  if not use_rational:</span>
                    <span class="c1">##  F.write(strW % o)</span>
                <span class="c1">##  else:</span>
                    <span class="c1">##  F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>
        <span class="c1">##  else:</span>
            <span class="c1">##  for o in OBJ_FUNC:</span>
                <span class="c1">##  o = -o</span>
                <span class="c1">##  if not use_rational:</span>
                    <span class="c1">##  F.write(strW % o)</span>
                <span class="c1">##  else:</span>
                    <span class="c1">##  F.write(&#39;%s &#39; % sympy.Rational(format % o))</span>
    <span class="c1">#else:</span>
        <span class="c1">#F.write(&#39;end\n&#39;)</span>
    <span class="c1">#F.write(&#39;\n&#39;)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.ine&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;.columns.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">M</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fname</span></div>


<span class="k">def</span> <span class="nf">writeListToLP</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">obj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">const</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bnds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">objtype</span><span class="o">=</span><span class="s1">&#39;maximize&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">objtype</span> <span class="o">=</span> <span class="n">objtype</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">objtype</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">objtype</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
    <span class="k">if</span> <span class="n">objtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;maximise&#39;</span><span class="p">,</span> <span class="s1">&#39;minimise&#39;</span><span class="p">]:</span>
        <span class="n">objtype</span> <span class="o">=</span> <span class="n">objtype</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;se&#39;</span><span class="p">,</span><span class="s1">&#39;ze&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">objtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="s1">&#39;minimize&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">objtype must be [&#39;maximize&#39;, &#39;minimize&#39;] not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">objtype</span>

    <span class="k">if</span> <span class="n">obj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;maximize&#39;</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Maximize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">objtype</span> <span class="o">==</span> <span class="s1">&#39;minimize&#39;</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Minimize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">const</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Subject to</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">const</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bnds</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bounds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bnds</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">END</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP written to: </span><span class="si">{}</span><span class="s1">.lp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">writeMinDistanceLP</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fbas</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignoreDistance</span><span class="o">=</span><span class="p">[],</span> <span class="n">with_protein_cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">moma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">fC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">objFname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">fC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">reactions</span><span class="p">))</span>
        <span class="n">objFname</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">prefix</span>
    <span class="n">fC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fC</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">alltrue</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fbas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">MOMA only defined for two inputs&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">alltrue</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Models must have the same number of fluxes</span><span class="se">\n</span><span class="s1">!&#39;</span>

    <span class="n">conL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># model flux_bounds</span>
    <span class="n">initial_cnstr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">fbas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">mt</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">mt</span><span class="o">.</span><span class="n">setPrefix</span><span class="p">(</span><span class="s1">&#39;mt_&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">mt</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">mt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;math&#39;</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsMath</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;relaxed&#39;</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsRelaxed</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="n">initial_cnstr</span><span class="p">:</span>
        <span class="n">ib</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ib</span><span class="p">:</span>
            <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">initial_cnstr</span>

    <span class="n">bndL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># model bounds</span>
    <span class="n">initial_bnds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">initial_bnds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPFluxBounds</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="n">initial_bnds</span><span class="p">:</span>
        <span class="n">ib</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ib</span><span class="p">:</span>
            <span class="n">bndL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">bndL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">initial_bnds</span>

    <span class="n">artVar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">artVarX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#ignoreDistance = []</span>

    <span class="n">Combi</span> <span class="o">=</span> <span class="n">CBTools</span><span class="o">.</span><span class="n">ComboGen</span><span class="p">()</span>
    <span class="n">Cnumber</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Cdata</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">unique_combinations</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fbas</span><span class="p">)):</span>
        <span class="n">Cdata</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">Cdata</span><span class="p">)</span>

    <span class="n">Combi</span><span class="o">.</span><span class="n">uniqueCombinations</span><span class="p">(</span><span class="n">Cdata</span><span class="p">,</span> <span class="n">Cnumber</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">Combi</span><span class="o">.</span><span class="n">numberifyComb2Int</span><span class="p">()</span>
    <span class="n">unique_combinations</span> <span class="o">=</span> <span class="n">Combi</span><span class="o">.</span><span class="n">combo_int</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data (</span><span class="si">{}</span><span class="s1">):</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Cnumber</span><span class="p">,</span> <span class="n">Cdata</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UniqueCombinStr:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Combi</span><span class="o">.</span><span class="n">combo</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UniqueCombinations:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_combinations</span><span class="p">))</span>

    <span class="n">zbase</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">combcount</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">unique_combinations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">uq</span><span class="p">)</span>
        <span class="n">MD0</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">MD0</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
            <span class="n">MD1</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">MD1</span><span class="o">.</span><span class="n">setPrefix</span><span class="p">(</span><span class="s1">&#39;mt_&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MD1</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">RiD1</span> <span class="o">=</span> <span class="n">MD0</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
        <span class="n">RiD2</span> <span class="o">=</span> <span class="n">MD1</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">RiD2</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoreDistance</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
                    <span class="n">ridx2</span> <span class="o">=</span> <span class="n">RiD2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">MD1</span><span class="o">.</span><span class="n">prefix</span><span class="o">+</span><span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ridx2</span> <span class="o">=</span> <span class="n">s</span>
                <span class="c1">##  av = &#39;z%s&#39; % (zbase+s+1)</span>
                <span class="n">av</span> <span class="o">=</span> <span class="s1">&#39;zvar</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">combcount</span><span class="p">,</span><span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

                <span class="n">c1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">a: </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> &lt;= 0.0&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">RiD2</span><span class="p">[</span><span class="n">ridx2</span><span class="p">],</span> <span class="n">av</span><span class="p">)</span>
                <span class="c1">##  c1 = &#39;%s - %s - %s &lt;= 0.0&#39; % (RiD1[s], RiD2[s], av)</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">b: </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> &gt;= 0.0&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">RiD2</span><span class="p">[</span><span class="n">ridx2</span><span class="p">],</span> <span class="n">av</span><span class="p">)</span>
                <span class="c1">##  c2 = &#39;%s - %s + %s &gt;= 0.0&#39; % (RiD1[s], RiD2[s], av)</span>

                <span class="c1"># add the protein cost</span>
                <span class="k">if</span> <span class="n">with_protein_cost</span><span class="p">:</span>
                    <span class="n">av</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_COST&#39;</span><span class="p">],</span> <span class="n">av</span><span class="p">)</span>
                <span class="n">artVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>
                <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
                <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>

        <span class="n">combcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">zbase</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">)</span>

    <span class="n">objS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">multi: &#39;</span> <span class="o">%</span> <span class="n">objFname</span>
    <span class="n">vcntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">artVar</span><span class="p">:</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + &#39;</span> <span class="o">%</span> <span class="n">v</span>
        <span class="n">vcntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">vcntr</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
            <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">vcntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">objS</span> <span class="o">=</span> <span class="n">objS</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artVarX</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="se">\\</span><span class="s1">* Ignored: &#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">artVarX</span><span class="p">:</span>
            <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">o</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;*</span><span class="se">\\\n</span><span class="s1">&#39;</span>
    <span class="n">objL</span> <span class="o">=</span> <span class="p">[</span><span class="n">objS</span><span class="p">]</span>

    <span class="n">objFcnstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Only single fluxObjectives dealt with at this time&quot;</span>
    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">objFcnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> &gt;= </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>\
                                             <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
            <span class="n">objFcnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> &gt;= </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>\
                                                 <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">conL</span> <span class="o">=</span> <span class="n">conL</span> <span class="o">+</span> <span class="n">objFcnstr</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">objL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conL</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bndL</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> MultiInputMinimization: &#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, &#39;</span> <span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">header</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Minimize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Subject to</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bounds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bndL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;END</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP written to: </span><span class="si">{}</span><span class="s1">.lp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">writeMinDistanceLP_absL1</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fbas</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignoreDistance</span><span class="o">=</span><span class="p">[],</span> <span class="n">bigM</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">with_protein_cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">moma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="n">fC</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">objFname</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">fC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">reactions</span><span class="p">))</span>
        <span class="n">objFname</span> <span class="o">+=</span> <span class="n">l</span><span class="o">.</span><span class="n">prefix</span>
    <span class="n">fC</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fC</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fC</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">alltrue</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">fbas</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">MOMA only defined for two inputs&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">numpy</span><span class="o">.</span><span class="n">alltrue</span><span class="p">((</span><span class="n">fC</span> <span class="o">==</span> <span class="n">fC</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Models must have the same number of fluxes</span><span class="se">\n</span><span class="s1">!&#39;</span>


    <span class="n">conL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># model flux_bounds</span>
    <span class="n">initial_cnstr</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">fbas</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">mt</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="n">mt</span><span class="o">.</span><span class="n">setPrefix</span><span class="p">(</span><span class="s1">&#39;mt_&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">mt</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">mt</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;math&#39;</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsMath</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">constraint_mode</span> <span class="o">==</span> <span class="s1">&#39;relaxed&#39;</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsRelaxed</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_cnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPConstraintsStrict</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="n">initial_cnstr</span><span class="p">:</span>
        <span class="n">ib</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ib</span><span class="p">:</span>
            <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">initial_cnstr</span>

    <span class="n">bndL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># model bounds</span>
    <span class="n">initial_bnds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">bigMS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">initial_bnds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BuildLPFluxBounds</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
        <span class="c1">##  bigMS.append(max([abs(float(v.value)) for v in f.reactions]))</span>
    <span class="k">for</span> <span class="n">ib</span> <span class="ow">in</span> <span class="n">initial_bnds</span><span class="p">:</span>
        <span class="n">ib</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ib</span><span class="p">:</span>
            <span class="n">bndL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">bndL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">initial_bnds</span>

    <span class="n">Combi</span> <span class="o">=</span> <span class="n">CBTools</span><span class="o">.</span><span class="n">ComboGen</span><span class="p">()</span>
    <span class="n">Cnumber</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">Cdata</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">unique_combinations</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fbas</span><span class="p">)):</span>
        <span class="n">Cdata</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">Cdata</span><span class="p">)</span>

    <span class="n">Combi</span><span class="o">.</span><span class="n">uniqueCombinations</span><span class="p">(</span><span class="n">Cdata</span><span class="p">,</span> <span class="n">Cnumber</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="p">[])</span>
    <span class="n">Combi</span><span class="o">.</span><span class="n">numberifyComb2Int</span><span class="p">()</span>
    <span class="n">unique_combinations</span> <span class="o">=</span> <span class="n">Combi</span><span class="o">.</span><span class="n">combo_int</span>

    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data (</span><span class="si">{}</span><span class="s1">):</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Cnumber</span><span class="p">,</span> <span class="n">Cdata</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UniqueCombinStr:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Combi</span><span class="o">.</span><span class="n">combo</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;UniqueCombinations:</span><span class="se">\n</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unique_combinations</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">bigMS</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">bigM = &#39;</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="c1">##  ILPMETHOD = &#39;SK&#39; # steven</span>
    <span class="n">ILPMETHOD</span> <span class="o">=</span> <span class="s1">&#39;GK&#39;</span> <span class="c1"># gunnar</span>
    <span class="n">zbase</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">combcount</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">artVar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">artVarX</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#ignoreDistance = []</span>
    <span class="n">boolVars</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">uq</span> <span class="ow">in</span> <span class="n">unique_combinations</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">uq</span><span class="p">)</span>
        <span class="n">MD0</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
            <span class="n">MD1</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">MD1</span><span class="o">.</span><span class="n">setPrefix</span><span class="p">(</span><span class="s1">&#39;mt_&#39;</span><span class="p">,</span> <span class="s1">&#39;all&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">MD1</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="n">uq</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

        <span class="n">RiD1</span> <span class="o">=</span> <span class="n">MD0</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
        <span class="n">RiD2</span> <span class="o">=</span> <span class="n">MD1</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">RiD2</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignoreDistance</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
                    <span class="n">ridx2</span> <span class="o">=</span> <span class="n">RiD2</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">MD1</span><span class="o">.</span><span class="n">prefix</span><span class="o">+</span><span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ridx2</span> <span class="o">=</span> <span class="n">s</span>
                <span class="n">Var1</span> <span class="o">=</span> <span class="n">RiD1</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
                <span class="n">bVar1</span> <span class="o">=</span>  <span class="s1">&#39;xvar_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">Var1</span>
                <span class="n">absVar1</span> <span class="o">=</span> <span class="s1">&#39;absL_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">Var1</span>
                <span class="n">Var2</span> <span class="o">=</span> <span class="n">RiD2</span><span class="p">[</span><span class="n">ridx2</span><span class="p">]</span>
                <span class="n">bVar2</span> <span class="o">=</span>  <span class="s1">&#39;xvar_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">Var2</span>
                <span class="n">absVar2</span> <span class="o">=</span> <span class="s1">&#39;absL_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">Var2</span>

                <span class="n">c0a</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> &gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">)</span>
                <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> &gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">ILPMETHOD</span> <span class="o">==</span> <span class="s1">&#39;GK&#39;</span><span class="p">:</span>
                    <span class="c1"># gunnar</span>
                    <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar1</span><span class="p">)</span>
                    <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ILPMETHOD</span> <span class="o">==</span> <span class="s1">&#39;SK&#39;</span><span class="p">:</span>
                    <span class="c1"># steven</span>
                    <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar1</span><span class="p">)</span>
                    <span class="n">c0a</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar1</span><span class="p">,</span> <span class="n">Var1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar1</span><span class="p">,</span> <span class="n">bigM</span><span class="p">)</span>

                <span class="n">c0b</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> &gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">)</span>
                <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> &gt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ILPMETHOD</span> <span class="o">==</span> <span class="s1">&#39;GK&#39;</span><span class="p">:</span>
                    <span class="c1"># gunnar</span>
                    <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar2</span><span class="p">)</span>
                    <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">ILPMETHOD</span> <span class="o">==</span> <span class="s1">&#39;SK&#39;</span><span class="p">:</span>
                    <span class="c1"># steven</span>
                    <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= 0</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar2</span><span class="p">)</span>
                    <span class="n">c0b</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1"> &lt;= </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">absVar2</span><span class="p">,</span> <span class="n">Var2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">,</span> <span class="n">bVar2</span><span class="p">,</span> <span class="n">bigM</span><span class="p">)</span>

                <span class="n">c0</span> <span class="o">=</span> <span class="n">c0a</span> <span class="o">+</span> <span class="n">c0b</span>

                <span class="n">av</span> <span class="o">=</span> <span class="s1">&#39;zvar</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">combcount</span><span class="p">,</span><span class="n">Var1</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">prefix</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">bVar1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boolVars</span><span class="p">:</span>
                    <span class="n">boolVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bVar1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">bVar2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">boolVars</span><span class="p">:</span>
                    <span class="n">boolVars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bVar2</span><span class="p">)</span>
                <span class="n">c1</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">a: </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> &lt;= 0.0&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">absVar1</span><span class="p">,</span> <span class="n">absVar2</span><span class="p">,</span> <span class="n">av</span><span class="p">)</span>
                <span class="n">c2</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">b: </span><span class="si">%s</span><span class="s1"> - </span><span class="si">%s</span><span class="s1"> + </span><span class="si">%s</span><span class="s1"> &gt;= 0.0&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">absVar1</span><span class="p">,</span> <span class="n">absVar2</span><span class="p">,</span> <span class="n">av</span><span class="p">)</span>

                <span class="c1"># add the protein cost</span>
                <span class="k">if</span> <span class="n">with_protein_cost</span><span class="p">:</span>
                    <span class="n">av</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_COST&#39;</span><span class="p">],</span> <span class="n">av</span><span class="p">)</span>
                <span class="n">artVar</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">av</span><span class="p">)</span>

                <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c0</span><span class="p">)</span>
                <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">)</span>
                <span class="n">conL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
        <span class="n">combcount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">zbase</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MD0</span><span class="o">.</span><span class="n">reactions</span><span class="p">)</span>

    <span class="n">objS</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">multi: &#39;</span> <span class="o">%</span> <span class="n">objFname</span>
    <span class="n">vcntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">artVar</span><span class="p">:</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> + &#39;</span> <span class="o">%</span> <span class="n">v</span>
        <span class="n">vcntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">vcntr</span> <span class="o">&gt;=</span> <span class="mi">500</span><span class="p">:</span>
            <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">vcntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">objS</span> <span class="o">=</span> <span class="n">objS</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">artVarX</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39; </span><span class="se">\\</span><span class="s1">* Ignored: &#39;</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">artVarX</span><span class="p">:</span>
            <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">o</span>
        <span class="n">objS</span> <span class="o">+=</span> <span class="s1">&#39;*</span><span class="se">\\\n</span><span class="s1">&#39;</span>
    <span class="n">objL</span> <span class="o">=</span> <span class="p">[</span><span class="n">objS</span><span class="p">]</span>

    <span class="n">objFcnstr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39; &#39;</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Only single fluxObjectives dealt with at this time&quot;</span>
    <span class="k">if</span> <span class="n">moma</span><span class="p">:</span>
        <span class="c1">#OFvalue = f.objectives[f.activeObjIdx].value</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">fbas</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">objFcnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> &gt;= </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>\
                                             <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
            <span class="n">objFcnstr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;C_</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1"> &gt;= </span><span class="si">%f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span>\
                                                 <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="n">conL</span> <span class="o">=</span> <span class="n">conL</span> <span class="o">+</span> <span class="n">objFcnstr</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">objL</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conL</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bndL</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">header</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> MultiInputMinimization: &#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fbas</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, &#39;</span> <span class="o">%</span> <span class="n">f</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">header</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Minimize</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">objL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">o</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Subject to</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">c</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Bounds</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bndL</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">boolVars</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;Binary</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">boolVars</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">END</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LP written to: </span><span class="si">{}</span><span class="s1">.lp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.lp&#39;</span><span class="p">)</span>



<div class="viewcode-block" id="writeMinDistanceLPwithCost"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeMinDistanceLPwithCost">[docs]</a><span class="k">def</span> <span class="nf">writeMinDistanceLPwithCost</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fbas</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignoreDistance</span><span class="o">=</span><span class="p">[],</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For backwards compatability only</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">**********</span><span class="se">\n</span><span class="s2">Deprecation warning!</span><span class="se">\n</span><span class="s2">Please use writeMinDistanceLP(with_protein_cost=True) instead of writeMinDistanceLPwithCost()</span><span class="se">\n\n</span><span class="s2">**********</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">writeMinDistanceLP</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">fbas</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">ignoreDistance</span><span class="o">=</span><span class="n">ignoreDistance</span><span class="p">,</span> <span class="n">with_protein_cost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">constraint_mode</span><span class="o">=</span><span class="n">constraint_mode</span><span class="p">)</span></div>

<span class="c1"># CAN GO SOON JUST PUTTING IN FOR SVN SYNCH</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">def writeMinDistanceLPwithCost(fname, fbas, work_dir=None, ignoreDistance=[], constraint_mode=&#39;strict&#39;):</span>
<span class="sd">    if work_dir == None:</span>
<span class="sd">        work_dir = os.getcwd()</span>

<span class="sd">    fC = []</span>
<span class="sd">    objFname = &#39;&#39;</span>
<span class="sd">    for l in fbas:</span>
<span class="sd">        fC.append(len(l.reactions))</span>
<span class="sd">        objFname += l.prefix</span>
<span class="sd">    fC = numpy.array(fC)</span>
<span class="sd">    if __DEBUG__:</span>
<span class="sd">        print fC</span>
<span class="sd">        print (fC == fC[0])</span>
<span class="sd">        print numpy.alltrue((fC == fC[0]))</span>
<span class="sd">    assert numpy.alltrue((fC == fC[0])), &#39;\nModels must have the same number of fluxes\n!&#39;</span>

<span class="sd">    conL = []</span>
<span class="sd">    # model flux_bounds</span>
<span class="sd">    initial_cnstr = []</span>

<span class="sd">    for f in fbas:</span>
<span class="sd">        if constraint_mode == &#39;math&#39;:</span>
<span class="sd">            initial_cnstr.append(BuildLPConstraintsMath(f))</span>
<span class="sd">        elif constraint_mode == &#39;relaxed&#39;:</span>
<span class="sd">            initial_cnstr.append(BuildLPConstraintsRelaxed(f))</span>
<span class="sd">        else:</span>
<span class="sd">            initial_cnstr.append(BuildLPConstraintsStrict(f))</span>

<span class="sd">    for ib in initial_cnstr:</span>
<span class="sd">        ib.seek(0)</span>
<span class="sd">        for l in ib:</span>
<span class="sd">            conL.append(l.strip())</span>
<span class="sd">        conL.append(&#39; &#39;)</span>
<span class="sd">    del initial_cnstr</span>

<span class="sd">    bndL = []</span>
<span class="sd">    # model bounds</span>
<span class="sd">    initial_bnds = []</span>
<span class="sd">    for f in fbas:</span>
<span class="sd">        initial_bnds.append(BuildLPFluxBounds(f))</span>
<span class="sd">    for ib in initial_bnds:</span>
<span class="sd">        ib.seek(0)</span>
<span class="sd">        for l in ib:</span>
<span class="sd">            bndL.append(l.strip())</span>
<span class="sd">        bndL.append(&#39; &#39;)</span>
<span class="sd">    del initial_bnds</span>

<span class="sd">    artVar = []</span>
<span class="sd">    artVarX = []</span>
<span class="sd">    ignoreDistance = []</span>

<span class="sd">    Combi = CBTools.ComboGen()</span>
<span class="sd">    Cnumber = 2</span>
<span class="sd">    Cdata = &#39;&#39;</span>
<span class="sd">    unique_combinations = None</span>
<span class="sd">    for x in range(len(fbas)):</span>
<span class="sd">        Cdata += &#39;%s&#39; % x</span>
<span class="sd">    if __DEBUG__: print Cdata</span>

<span class="sd">    Combi.uniqueCombinations(Cdata, Cnumber, temp=[])</span>
<span class="sd">    Combi.numberifyComb2Int()</span>
<span class="sd">    unique_combinations = Combi.combo_int</span>

<span class="sd">    if __DEBUG__:</span>
<span class="sd">        print &#39;Data (%s):\n%s\n&#39; % (Cnumber, Cdata)</span>
<span class="sd">        print &#39;UniqueCombinStr:\n%s&#39; % Combi.combo</span>
<span class="sd">        print &#39;UniqueCombinations:\n%s&#39; % unique_combinations</span>

<span class="sd">    zbase = 0</span>
<span class="sd">    combcount = 1</span>
<span class="sd">    for uq in unique_combinations:</span>
<span class="sd">        if __DEBUG__: print uq</span>
<span class="sd">        RiD1 = fbas[uq[0]].getReactionIds()</span>
<span class="sd">        RiD2 = fbas[uq[1]].getReactionIds()</span>
<span class="sd">        for s in range(len(fbas[uq[0]].reactions)):</span>
<span class="sd">            if __DEBUG__: print RiD1[s], RiD2[s]</span>
<span class="sd">            if RiD1[s] not in ignoreDistance:</span>
<span class="sd">                ##  av = &#39;z%s&#39; % (zbase+s+1)</span>
<span class="sd">                ##  av = &#39;zvar%s&#39; % (RiD1[s].replace(fbas[uq[0]].prefix,&#39;&#39;))</span>
<span class="sd">                av = &#39;zvar%s%s&#39; % (combcount,RiD1[s].replace(fbas[uq[0]].prefix,&#39;&#39;))</span>
<span class="sd">                c1 = &#39;%sa: %s - %s - %s &lt;= 0.0&#39; % (av, RiD1[s], RiD2[s], av)</span>
<span class="sd">                ##  c1 = &#39;%s - %s - %s &lt;= 0.0&#39; % (RiD1[s], RiD2[s], av)</span>
<span class="sd">                c2 = &#39;%sb: %s - %s + %s &gt;= 0.0&#39; % (av, RiD1[s], RiD2[s], av)</span>
<span class="sd">                ##  c2 = &#39;%s - %s + %s &gt;= 0.0&#39; % (RiD1[s], RiD2[s], av)</span>
<span class="sd">                conL.append(c1)</span>
<span class="sd">                conL.append(c2)</span>
<span class="sd">                ##  print RiD1[s], RiD2[s], av</span>
<span class="sd">                ##  print fbas[uq[0]].reactions[s].getId(), fbas[uq[1]].reactions[s].getId()</span>
<span class="sd">                ##  print fbas[uq[0]].reactions[s].annotation[&#39;CBM_PEPTIDE_COST&#39;], fbas[uq[1]].reactions[s].annotation[&#39;CBM_PEPTIDE_COST&#39;]</span>
<span class="sd">                av = &#39;%s %s&#39; % (fbas[uq[0]].reactions[s].annotation[&#39;CBM_PEPTIDE_COST&#39;], av)</span>
<span class="sd">                ##  print RiD1[s], RiD2[s], av</span>
<span class="sd">                artVar.append(av)</span>
<span class="sd">            else:</span>
<span class="sd">                # THIS MAY BE A BUG</span>
<span class="sd">                ##  av = &#39;z%s&#39; % (zbase+s+1)</span>
<span class="sd">                ##  av = &#39;zvar%s&#39; % (RiD1[s].replace(fbas[uq[0]].prefix,&#39;&#39;))</span>
<span class="sd">                av = &#39;zvar%s%s&#39; % (combcount,RiD1[s].replace(fbas[uq[0]].prefix,&#39;&#39;))</span>
<span class="sd">                artVarX.append(av)</span>
<span class="sd">                c1 = &#39;\\* %sa: %s - %s - %s &lt;= 0.0 *\\&#39; % (av, RiD1[s], RiD2[s], av)</span>
<span class="sd">                ##  c1 = &#39;\\* %s - %s - %s &lt;= 0.0 *\\&#39; % (RiD1[s], RiD2[s], av)</span>
<span class="sd">                c2 = &#39;\\* %sb: %s - %s + %s &gt;= 0.0 *\\&#39; % (av, RiD1[s], RiD2[s], av)</span>
<span class="sd">                ##  c2 = &#39;\\* %s - %s + %s &gt;= 0.0 *\\&#39; % (RiD1[s], RiD2[s], av)</span>
<span class="sd">                conL.append(c1)</span>
<span class="sd">                conL.append(c2)</span>
<span class="sd">        combcount += 1</span>
<span class="sd">        zbase += len(fbas[uq[0]].reactions)</span>

<span class="sd">    objS = &#39;%smulti: &#39; % objFname</span>
<span class="sd">    vcntr = 0</span>
<span class="sd">    for v in artVar:</span>
<span class="sd">        objS += &#39;%s + &#39; % v</span>
<span class="sd">        vcntr += 1</span>
<span class="sd">        if vcntr &gt;= 500:</span>
<span class="sd">            objS += &#39;\n&#39;</span>
<span class="sd">            vcntr = 0</span>
<span class="sd">    objS = objS[:-3]</span>
<span class="sd">    if len(artVarX) &gt;= 1:</span>
<span class="sd">        objS += &#39; \\* Ignored: &#39;</span>
<span class="sd">        for o in artVarX:</span>
<span class="sd">            objS += &#39;%s &#39; % o</span>
<span class="sd">        objS += &#39;*\\\n&#39;</span>
<span class="sd">    objL = [objS]</span>

<span class="sd">    objFcnstr = [&#39; &#39;]</span>
<span class="sd">    for f in fbas:</span>
<span class="sd">        objFcnstr.append(&#39;C_%s: %s &gt;= %f&#39; % (f.objectives[f.activeObjIdx].getFluxObjectiveReactions()[0],\</span>
<span class="sd">                                    f.objectives[f.activeObjIdx].getFluxObjectiveReactions()[0], f.objectives[f.activeObjIdx].value))</span>
<span class="sd">    conL = conL + objFcnstr</span>

<span class="sd">    if __DEBUG__:</span>
<span class="sd">        print objL</span>
<span class="sd">        for c in conL:</span>
<span class="sd">            print c</span>
<span class="sd">        print &#39; &#39;</span>
<span class="sd">        for b in bndL:</span>
<span class="sd">            print b</span>

<span class="sd">    F = open(os.path.join(work_dir, fname+&#39;.lp&#39;), &#39;w&#39;)</span>
<span class="sd">    header = &#39;\\\\ MultiInputMinimization: &#39;</span>
<span class="sd">    for f in fbas:</span>
<span class="sd">        header += &#39;%s, &#39; % f.getId()</span>
<span class="sd">    F.write(&#39;%s\n&#39; % header[:-2])</span>
<span class="sd">    F.write(&#39;\nMinimize\n&#39;)</span>
<span class="sd">    for o in objL:</span>
<span class="sd">        F.write(&#39;%s \n&#39; % o)</span>
<span class="sd">    F.write(&#39;\nSubject to\n&#39;)</span>
<span class="sd">    for c in conL:</span>
<span class="sd">        F.write(&#39;%s \n&#39; % c)</span>
<span class="sd">    F.write(&#39;\nBounds\n&#39;)</span>
<span class="sd">    for b in bndL:</span>
<span class="sd">        F.write(&#39; %s \n&#39; % b)</span>
<span class="sd">    F.write(&#39;END\n\n&#39;)</span>
<span class="sd">    F.close()</span>
<span class="sd">    print &#39;LP written to: %s.lp&#39; % os.path.join(work_dir, fname)</span>
<span class="sd">    return os.path.join(work_dir, fname+&#39;.lp&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="writeOptimalSolution"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeOptimalSolution">[docs]</a><span class="k">def</span> <span class="nf">writeOptimalSolution</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">only_exchange</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function writes the optimal solution to file</span>

<span class="sd">     - *fba* an instance of an PySCeSCBM model</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *Dir* [default=None] use current directory if not None</span>
<span class="sd">     - *separator* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *only_exchange* [default=False] only output fluxes labelled as exchange reactions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Path does not exist&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">separator</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
        <span class="n">fname_r</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;_solution.csv&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname_r</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;_solution.txt&#39;</span>
    <span class="n">objName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">():</span>
            <span class="n">objName</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="n">J</span>
        <span class="n">objName</span> <span class="o">=</span> <span class="n">objName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">objName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_r</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">CSV file </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> is locked by an external application (probably Excel) please close file and try again (or use a different filename).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_r</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s%s%s%s%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;ObjectiveFunction&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">objName</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">separator</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Reaction&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Reduced cost&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Gene association&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">GO</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_exchange</span><span class="p">:</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">only_exchange</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">:</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">GO</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                <span class="n">gene</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gene</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">bnds</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
            <span class="n">Lbnd</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">Ubnd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="n">bnds</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Lbnd</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Ubnd</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span><span class="n">separator</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">Lbnd</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">Ubnd</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">reduced_cost</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">gene</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reactions exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_r</span><span class="p">))</span></div>

<div class="viewcode-block" id="writeModelInfoToFile"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelInfoToFile">[docs]</a><span class="k">def</span> <span class="nf">writeModelInfoToFile</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">only_exchange</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">met_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function writes a CBModel to file</span>

<span class="sd">     - *fba* an instance of an PySCeSCBM model</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *Dir* [default=None] use directory if not None</span>
<span class="sd">     - *separator* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *only_exchange* [default=False] only output fluxes labelled as exchange reactions</span>
<span class="sd">     - *type* [default=&#39;all&#39;] only output certain type of species: &#39;all&#39;,&#39;boundary&#39; or &#39;variable&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">writeReactionInfoToFile</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="n">Dir</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span> <span class="n">only_exchange</span><span class="o">=</span><span class="n">only_exchange</span><span class="p">)</span>
    <span class="n">writeSpeciesInfoToFile</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="n">Dir</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="n">separator</span><span class="p">,</span> <span class="n">met_type</span><span class="o">=</span><span class="n">met_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeReactionInfoToFile"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeReactionInfoToFile">[docs]</a><span class="k">def</span> <span class="nf">writeReactionInfoToFile</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">only_exchange</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function writes a CBModel to file</span>

<span class="sd">     - *fba* an instance of an PySCeSCBM model</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *Dir* [default=None] use directory if not None</span>
<span class="sd">     - *separator* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *only_exchange* [default=False] only output fluxes labelled as exchange reactions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Path does not exist&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">separator</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
        <span class="n">fname_r</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.rxns.csv&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname_r</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.rxns.txt&#39;</span>
    <span class="n">objName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">():</span>
            <span class="n">objName</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="n">J</span>
        <span class="n">objName</span> <span class="o">=</span> <span class="n">objName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">objName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_r</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Output file </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> is locked by an external application (probably Excel) please close file and try again (or use a different filename).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_r</span><span class="p">))</span>
        <span class="k">return</span>
    <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s%s%s%s%s%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;ObjectiveFunction&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">objName</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">separator</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Reaction&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;LowerBound&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;UpperBound&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Equation&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Gene association&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">only_exchange</span><span class="p">:</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">only_exchange</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">:</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">GO</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                <span class="n">gene</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gene</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
            <span class="n">bnds</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
            <span class="n">Lbnd</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">Ubnd</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">if</span> <span class="n">bnds</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Lbnd</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">Ubnd</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">reversible</span><span class="p">:</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;REVERSIBLE_SYMBOL&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">equation</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1"> &#39;</span>  <span class="o">%</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;IRREVERSIBLE_SYMBOL&#39;</span><span class="p">]</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">prods</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                        <span class="n">prods</span> <span class="o">+=</span> <span class="s1">&#39; + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">prods</span> <span class="o">+=</span> <span class="s1">&#39; + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">),</span> <span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                        <span class="n">subs</span> <span class="o">+=</span> <span class="s1">&#39; + </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">subs</span> <span class="o">+=</span> <span class="s1">&#39; + </span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">),</span> <span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="n">subs</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">prods</span> <span class="o">=</span> <span class="n">prods</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
            <span class="n">equation</span> <span class="o">=</span> <span class="n">subs</span> <span class="o">+</span> <span class="n">equation</span> <span class="o">+</span> <span class="n">prods</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span><span class="n">separator</span><span class="p">,</span><span class="n">Lbnd</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">Ubnd</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">r</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">equation</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">gene</span><span class="p">))</span>
            <span class="n">GO</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reactions exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_r</span><span class="p">))</span></div>

<div class="viewcode-block" id="writeSpeciesInfoToFile"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSpeciesInfoToFile">[docs]</a><span class="k">def</span> <span class="nf">writeSpeciesInfoToFile</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">met_type</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function writes a CBModel to file</span>

<span class="sd">     - *fba* an instance of an PySCeSCBM model</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *Dir* [default=None] use directory if not None</span>
<span class="sd">     - *separator* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *met_type* [default=&#39;all&#39;] only output certain type of species: &#39;all&#39;,&#39;boundary&#39; or &#39;variable&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">Dir</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Path does not exist&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dir</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">separator</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">:</span>
        <span class="n">fname_s</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.spec.csv&#39;</span>
        <span class="n">fname_sr</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.s2r.csv&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fname_s</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.spec.txt&#39;</span>
        <span class="n">fname_sr</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="s1">&#39;.s2r.txt&#39;</span>
    <span class="k">if</span> <span class="n">met_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span><span class="s1">&#39;boundary&#39;</span><span class="p">,</span><span class="s1">&#39;variable&#39;</span><span class="p">]:</span>
        <span class="n">met_type</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">F2</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_s</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">F3</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname_sr</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Output file </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> is locked by an external application (probably Excel) please close file and try again (or use a different filename).&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_s</span><span class="p">))</span>
        <span class="k">return</span>

    <span class="n">maxReagentOf</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">F2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Species&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Compartment&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Fixed&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;ChemicalFormula&#39;</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="s1">&#39;Charge&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">isReagentOf</span><span class="p">())</span> <span class="o">&gt;</span> <span class="n">maxReagentOf</span><span class="p">:</span>
            <span class="n">maxReagentOf</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">reagent_of</span><span class="p">)</span>
        <span class="n">GOS</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;variable&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;boundary&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">GOS</span><span class="p">:</span>
            <span class="n">F2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s%s%s%s%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span><span class="n">separator</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span><span class="n">separator</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">compartment</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span><span class="p">,</span><span class="n">separator</span><span class="p">,</span><span class="n">s</span><span class="o">.</span><span class="n">charge</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="n">srl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">reagent_of</span><span class="p">)</span>
        <span class="n">rgOut</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">separator</span><span class="p">)</span>

        <span class="n">GOS</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;variable&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">met_type</span> <span class="o">==</span> <span class="s1">&#39;boundary&#39;</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">is_boundary</span><span class="p">:</span>
            <span class="n">GOS</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">GOS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rg</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxReagentOf</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rg</span> <span class="o">&lt;</span> <span class="n">srl</span><span class="p">:</span>
                    <span class="n">rgOut</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">reagent_of</span><span class="p">[</span><span class="n">rg</span><span class="p">],</span> <span class="n">separator</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rgOut</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">separator</span>
            <span class="n">F3</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">rgOut</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">F2</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">F3</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F3</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Species exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_s</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reagent map exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname_sr</span><span class="p">))</span></div>



<div class="viewcode-block" id="printFBASolution"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.printFBASolution">[docs]</a><span class="k">def</span> <span class="nf">printFBASolution</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">include_all</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the FBA optimal solution to the screen.</span>

<span class="sd">     - *fba* an FBA model object</span>
<span class="sd">     - *include_all* include all variables</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">OFflux</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reaction</span>
    <span class="n">OFvalue</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">OFSense</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">objectives</span><span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">activeObjIdx</span><span class="p">]</span><span class="o">.</span><span class="n">operation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">**********</span><span class="se">\n</span><span class="s1">Model: </span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> objective: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">Optimal value: </span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OFSense</span><span class="p">,</span><span class="n">OFflux</span><span class="p">,</span><span class="n">OFvalue</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">include_all</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">J</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">J</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">J</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**********</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="exportModel"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.exportModel">[docs]</a><span class="k">def</span> <span class="nf">exportModel</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;lp&#39;</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the FBA model in different formats:</span>

<span class="sd">     - *fba* the FBA model</span>
<span class="sd">     - *fname* [default=None] the exported filename if None then `fba.getId()` is used</span>
<span class="sd">     - *fmt* [default=&#39;lp&#39;] the export format can be one of: &#39;lp&#39; (CPLEX), &#39;hformat&#39; (Polyhedra), &#39;all&#39; (both)</span>
<span class="sd">     - *use_rational* [default=&#39;both&#39;] if *all* or *hformat* is specified should hformat files be written using rational math or not. The default *both* is the legacy behaviour and writes both.</span>

<span class="sd">    Note that &#39;hformat&#39; ignores &#39;fname&#39; and only uses fba.getId() this is a legacy behaviour</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;lp&#39;</span><span class="p">:</span>
        <span class="n">writeModelLP</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span> <span class="ow">or</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s1">&#39;hformat&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_rational</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">)</span>
            <span class="n">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">use_rational</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">use_rational</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">use_rational</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">writeModelHFormatFBA2</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeProteinCostToCSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeProteinCostToCSV">[docs]</a><span class="k">def</span> <span class="nf">writeProteinCostToCSV</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes the protein costs &#39;CBM_PEPTIDE_COST&#39; annotation toa csv file.</span>

<span class="sd">     - *fba* an instantiated FBA object</span>
<span class="sd">     - *fname* the exported file name</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.costs.csv&#39;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;rid,minL,maxL,avgL,cost</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">R</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">rid</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">pcost</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">avg_l</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">minL</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">maxL</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;CBM_PEPTIDE_COST&#39;</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">pcost</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_COST&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;CBM_PEPTIDE_LENGTH_MAX&#39;</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">maxL</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_LENGTH_MAX&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_LENGTH_MAX&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">avg_l</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;CBM_AVG_PEPTIDE_LENGTH&#39;</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                    <span class="n">avg_l</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_AVG_PEPTIDE_LENGTH&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">avg_l</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;CBM_PEPTIDE_LENGTH_MIN&#39;</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">minL</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CBM_PEPTIDE_LENGTH_MIN&#39;</span><span class="p">]</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rid</span><span class="p">,</span><span class="n">minL</span><span class="p">,</span><span class="n">maxL</span><span class="p">,</span><span class="n">avg_l</span><span class="p">,</span><span class="n">pcost</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Protein costs written to file: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="WriteFVAtoCSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteFVAtoCSV">[docs]</a><span class="k">def</span> <span class="nf">WriteFVAtoCSV</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">fva</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fbaObj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeFVAtoCSV()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeFVAtoCSV()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeFVAtoCSV</span><span class="p">(</span><span class="n">fva</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">Dir</span><span class="p">,</span> <span class="n">fbaObj</span><span class="p">)</span></div>

<span class="c1">#def writeFVAtoCSV(id, fva, names, Dir=None, fbaObj=None):</span>
    <span class="c1">#&quot;&quot;&quot;</span>
    <span class="c1">#INFO: this method will be deprecated please update your scripts to use \&quot;writeFVAtoCSV\&quot;</span>
    <span class="c1">#&quot;&quot;&quot;</span>
    <span class="c1">#print(&#39;\nINFO: this method will be deprecated please update your scripts to use \&quot;writeFVAtoCSV\&quot;\n&#39;)</span>
    <span class="c1">#time.sleep(1)</span>
    <span class="c1">#writeFVAtoCSV(id, fva, names, Dir, fbaObj)</span>

<div class="viewcode-block" id="writeFVAtoCSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeFVAtoCSV">[docs]</a><span class="k">def</span> <span class="nf">writeFVAtoCSV</span><span class="p">(</span><span class="n">fvadata</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">Dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fbaObj</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes the resuls of a FluxVariabilityAnalysis method and writes it to a nice</span>
<span class="sd">    csv file. Note this method replaces the glpk/cplx_WriteFVAtoCSV methods.</span>

<span class="sd">     - *fvadata* FluxVariabilityAnalysis() OUTPUT_ARRAY</span>
<span class="sd">     - *names* FluxVariabilityAnalysis() OUTPUT_NAMES</span>
<span class="sd">     - *fname* filename_base for the CSV output</span>
<span class="sd">     - *Dir* [default=None] if set the output directory for the csv files</span>
<span class="sd">     - *fbaObj* [default=None] if supplied adds extra model information into the output tables</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">Dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.fva.csv&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Dir</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.fva.csv&#39;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Dir</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fbaObj</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;name,optval,min,max,diff,red cost,minstat,maxstat</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;name,optval,min,max,diff,red cost,minstat,maxstat,&quot;equation&quot;,&quot;subsystem&quot;,&quot;gene association&quot;,&quot;confidence level&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">Jidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="n">Jidx</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">Jidx</span><span class="p">]</span>
            <span class="n">optval</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">minstat</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            <span class="n">maxstat</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">6</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fbaObj</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">minstat</span><span class="p">,</span> <span class="n">maxstat</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xInf</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">Ro</span> <span class="o">=</span> <span class="n">fbaObj</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Equation&#39;</span><span class="p">,</span><span class="s1">&#39;SUBSYSTEM&#39;</span><span class="p">,</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span><span class="s1">&#39;Confidence Level&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">Ro</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                        <span class="n">xInf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ro</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">xInf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,&quot;</span><span class="si">%s</span><span class="s1">&quot;,&quot;</span><span class="si">%s</span><span class="s1">&quot;,&quot;</span><span class="si">%s</span><span class="s1">&quot;,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">diff</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">minstat</span><span class="p">,</span> <span class="n">maxstat</span><span class="p">,</span> <span class="n">xInf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xInf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">xInf</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">xInf</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>

    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FVA results written to: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Dir</span><span class="p">))</span></div>

<div class="viewcode-block" id="WriteFVAdata"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.WriteFVAdata">[docs]</a><span class="k">def</span> <span class="nf">WriteFVAdata</span><span class="p">(</span><span class="n">fva</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">roundec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">appendfile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    INFO: this method will be deprecated please update your scripts to use \&quot;writeFVAdata()\&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: this method will be deprecated please update your scripts to use </span><span class="se">\&quot;</span><span class="s1">writeFVAdata()</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">writeFVAdata</span><span class="p">(</span><span class="n">fva</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">roundec</span><span class="p">,</span> <span class="n">scale_min</span><span class="p">,</span> <span class="n">appendfile</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></div>

<div class="viewcode-block" id="writeFVAdata"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeFVAdata">[docs]</a><span class="k">def</span> <span class="nf">writeFVAdata</span><span class="p">(</span><span class="n">fvadata</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">roundec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale_min</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">appendfile</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes the resuls of a FluxVariabilityAnalysis method and writes it to a nice</span>
<span class="sd">    csv file. Note this method replaces the glpk/cplx_WriteFVAtoCSV methods. Data is output as a csv file</span>
<span class="sd">    with columns: FluxName, FVA_MIN, FVA_MAX, OPT_VAL, SPAN</span>

<span class="sd">     - *fvadata* FluxVariabilityAnalysis() FVA OUTPUT_ARRAY</span>
<span class="sd">     - *names* FluxVariabilityAnalysis() FVA OUTPUT_NAMES</span>
<span class="sd">     - *fname* filename_base for the CSV output</span>
<span class="sd">     - *work_dir* [default=None] if set the output directory for the csv files</span>
<span class="sd">     - *roundec* [default=None] an integer indicating at which decimal to round off output. Default is no rounding.</span>
<span class="sd">     - *scale_min* [default=False] normalise each flux such that that FVA_MIN = 0.0</span>
<span class="sd">     - *appendfile* [default=False] instead of opening a new file try and append the data</span>
<span class="sd">     - *info* [default=None] a string added to the results as an extra column, useful with `appendfile`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">work_dir</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.fvadata.csv&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.fvadata.csv&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">appendfile</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">info</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Jid&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;optval&#39;</span><span class="p">,</span> <span class="s1">&#39;span&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Jid&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;optval&#39;</span><span class="p">,</span> <span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">Jidx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="n">Jidx</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">Jidx</span><span class="p">]</span>
            <span class="nb">max</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="nb">min</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">optval</span> <span class="o">=</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">roundec</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">max</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">roundec</span><span class="p">)</span>
                <span class="nb">min</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="n">roundec</span><span class="p">)</span>
                <span class="n">optval</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">optval</span><span class="p">,</span> <span class="n">roundec</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scale_min</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">min</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="nb">max</span> <span class="o">=</span> <span class="nb">max</span><span class="o">-</span><span class="nb">min</span>
                    <span class="n">optval</span> <span class="o">=</span> <span class="n">optval</span><span class="o">-</span><span class="nb">min</span>
                    <span class="nb">min</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">elif</span> <span class="nb">min</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="nb">max</span> <span class="o">=</span> <span class="nb">max</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
                    <span class="n">optval</span> <span class="o">=</span> <span class="n">optval</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span>
                    <span class="nb">min</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">if</span> <span class="n">info</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">roundec</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">roundec</span><span class="p">)))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">roundec</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">info</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">fvadata</span><span class="p">[</span><span class="n">Jidx</span><span class="p">][</span><span class="mi">2</span><span class="p">]),</span> <span class="n">roundec</span><span class="p">),</span> <span class="n">info</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;FVAdata results written to: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span></div>

<div class="viewcode-block" id="writeSolutions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeSolutions">[docs]</a><span class="k">def</span> <span class="nf">writeSolutions</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">sols</span><span class="o">=</span><span class="p">[],</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">extra_output</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fba</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write 2 or more solutions where a solution is a dictionary of flux:value pairs:</span>

<span class="sd">     - *fname* the export filename</span>
<span class="sd">     - *sols* a list of dictionaries containing flux:value pairs (e.g. output by cmod.getReactionValues())</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *extra_output* [default=None] add detailed information to output e.g. reaction names by giving a CBModel object as an argument to *extra_output*.</span>
<span class="sd">     - *fba* an fba model that canbe used for extra_output</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sols</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There must be two or more solutions to work with&quot;</span>

    <span class="n">reac_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">:</span>
        <span class="n">reac_ids</span> <span class="o">=</span> <span class="n">reac_ids</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="n">reac_ids</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reac_ids</span><span class="p">)</span>
    <span class="n">reac_ids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="n">reac_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">##  reac_bnds = []</span>
    <span class="c1">##  reac_eqns = []</span>
    <span class="k">if</span> <span class="n">extra_output</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fba</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">reac_ids</span><span class="p">:</span>
            <span class="n">reac_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
            <span class="c1">##  reac_bnds.append(fba.getReactionBounds(r.getId()))</span>

    <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reac_ids</span><span class="p">)):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">reac_ids</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">s_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sols</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">reac_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="ow">in</span> <span class="n">sols</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                <span class="n">s_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sols</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">reac_ids</span><span class="p">[</span><span class="n">r</span><span class="p">]],</span> <span class="n">sep</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s_str</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;</span><span class="se">\&quot;</span><span class="s1">none</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">+=</span> <span class="n">s_str</span>
        <span class="k">if</span> <span class="n">extra_output</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">reac_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Solutions written to: </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span><span class="p">)</span></div>


<div class="viewcode-block" id="generateBGID"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.generateBGID">[docs]</a><span class="k">def</span> <span class="nf">generateBGID</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a BGID generator, which is &lt;prefix&gt;&lt;num&gt; where perfix is two letters num is padded to 6 figures</span>
<span class="sd">     - *num* the starting number</span>
<span class="sd">     - *prefix* the two letter prefix</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">prefix</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="ow">and</span> <span class="n">prefix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Invalid prefix&#39;</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">yield</span> <span class="s1">&#39;</span><span class="si">{}{:0&gt;6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span></div>

<div class="viewcode-block" id="convertFloatToExcel"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.convertFloatToExcel">[docs]</a><span class="k">def</span> <span class="nf">convertFloatToExcel</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a float to Excel compatible &quot;number&quot;</span>

<span class="sd">     - *num* a number</span>
<span class="sd">     - *roundoff* the number of roundoff digits for round()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## keep this in sync with convertExcelToFloat</span>
    <span class="k">if</span> <span class="n">num</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="s1">&#39;nan&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isposinf</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="s1">&#39;inf&#39;</span>
    <span class="k">elif</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isneginf</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="s1">&#39;-inf&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rval</span></div>

<div class="viewcode-block" id="convertExcelToFloat"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.convertExcelToFloat">[docs]</a><span class="k">def</span> <span class="nf">convertExcelToFloat</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts an Excel &quot;number&quot; to a float</span>

<span class="sd">     - *num* a number</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">## keep this in sync with convertFloatToExcel</span>
    <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="n">num</span> <span class="ow">is</span> <span class="s1">&#39;nan&#39;</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;inf&#39;</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">elif</span> <span class="n">num</span> <span class="o">==</span> <span class="s1">&#39;-inf&#39;</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rval</span></div>

<div class="viewcode-block" id="writeModelToExcel97"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelToExcel97">[docs]</a><span class="k">def</span> <span class="nf">writeModelToExcel97</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">roundoff</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exports the model as an Excel 97 spreadsheet</span>

<span class="sd">     - *fba* a CBMPy model instance</span>
<span class="sd">     - *filename* the filename of the workbook</span>
<span class="sd">     - *roundoff* [default=6] the number of digits to round off to</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">_HAVE_XLWT_</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: Cannot create Excel file, XLWT package not available (http://pypi.python.org/pypi/xlwt)&#39;</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.xls&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: cannot open file &quot;</span><span class="si">{}</span><span class="s1">&quot;! Please close workbook before writing!</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.xls&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)))</span>
        <span class="k">return</span>

    <span class="n">fontB</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Font</span><span class="p">()</span>
    <span class="n">fontB</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">fontI</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Font</span><span class="p">()</span>
    <span class="n">fontI</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">fontBI</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Font</span><span class="p">()</span>
    <span class="n">fontBI</span><span class="o">.</span><span class="n">bold</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">fontBI</span><span class="o">.</span><span class="n">italic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">styleBold</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleBold</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontB</span>
    <span class="n">styleBoldC</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleBoldC</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontB</span>
    <span class="n">styleBoldC</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">horz</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Alignment</span><span class="o">.</span><span class="n">HORZ_CENTER</span>
    <span class="n">styleItalic</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleItalic</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontI</span>
    <span class="n">styleItalicC</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleItalicC</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontI</span>
    <span class="n">styleItalicC</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">horz</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Alignment</span><span class="o">.</span><span class="n">HORZ_CENTER</span>
    <span class="n">styleBoldItalic</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleBoldItalic</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontBI</span>
    <span class="n">styleBoldItalicC</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">XFStyle</span><span class="p">()</span>
    <span class="n">styleBoldItalicC</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">fontBI</span>
    <span class="n">styleBoldItalicC</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">horz</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Alignment</span><span class="o">.</span><span class="n">HORZ_CENTER</span>
    <span class="n">styleHyper</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">easyxf</span><span class="p">(</span><span class="s1">&#39;font: underline single&#39;</span><span class="p">)</span>
    <span class="n">styleHyper</span><span class="o">.</span><span class="n">alignment</span><span class="o">.</span><span class="n">horz</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Alignment</span><span class="o">.</span><span class="n">HORZ_CENTER</span>

    <span class="n">wb</span> <span class="o">=</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Workbook</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="n">wsInf</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">)</span>
    <span class="n">wsSol</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;solution&#39;</span><span class="p">)</span>
    <span class="n">wsRe</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;reactions&#39;</span><span class="p">)</span>
    <span class="n">wsMet</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;metabolites&#39;</span><span class="p">)</span>
    <span class="n">wsSt</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;network_react&#39;</span><span class="p">)</span>
    <span class="n">wsStR</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;network_metab&#39;</span><span class="p">)</span>
    <span class="n">wsMiriam</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;miriam&#39;</span><span class="p">)</span>
    <span class="n">wsComp</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;compartments&#39;</span><span class="p">)</span>
    <span class="n">wsGrp</span> <span class="o">=</span> <span class="n">wb</span><span class="o">.</span><span class="n">add_sheet</span><span class="p">(</span><span class="s1">&#39;groups&#39;</span><span class="p">)</span>

    <span class="n">ridx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;objective&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getOperation</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
    <span class="n">cidx</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getFluxObjectiveData</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span> <span class="n">t_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">t_</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">2</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;obj. value&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;modelcreated&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">DATE_CREATED</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_CREATED</span><span class="p">)):</span>
            <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">t_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">DATE_CREATED</span><span class="p">[</span><span class="n">t_</span><span class="p">])</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;lastmodified&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">DATE_MODIFIED</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">DATE_MODIFIED</span><span class="p">)):</span>
            <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">t_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">fba</span><span class="o">.</span><span class="n">DATE_MODIFIED</span><span class="p">[</span><span class="n">t_</span><span class="p">])</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">cTime</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">())</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;exported&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cTime</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">t_</span><span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">t_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cTime</span><span class="p">[</span><span class="n">t_</span><span class="p">])</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ccridx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">cr_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">getModelCreators</span><span class="p">():</span>
        <span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ccridx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span> <span class="s1">&#39;creator</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ccridx</span><span class="p">),</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ne_</span> <span class="ow">in</span> <span class="n">cr_</span><span class="p">:</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span> <span class="n">ne_</span><span class="p">)</span>
        <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">wsInf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Formula</span><span class="p">(</span><span class="s1">&#39;HYPERLINK(&quot;</span><span class="si">{}</span><span class="s1">&quot;;&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;http://cbmpy.sourceforge.net&#39;</span><span class="p">,</span> <span class="s1">&#39;Exported by CBMPy </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">__version__</span><span class="p">))),</span> <span class="n">styleHyper</span><span class="p">)</span>
    <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1">#Scol = [&#39;metabolite&#39;, &#39;value&#39;, &#39;shadow price&#39;, &#39;&#39;, &#39;reaction&#39;, &#39;flux&#39;, &#39;reduced cost&#39;, &#39;FVA min&#39;, &#39;FVA max&#39;]</span>
    <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">SCALED_REDUCED_COSTS</span><span class="p">:</span>
        <span class="n">rcstr</span> <span class="o">=</span> <span class="s1">&#39;scaled reduced cost&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rcstr</span> <span class="o">=</span> <span class="s1">&#39;reduced cost&#39;</span>

    <span class="n">Scol</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;reaction&#39;</span><span class="p">,</span> <span class="s1">&#39;flux&#39;</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">,</span> <span class="n">rcstr</span><span class="p">,</span> <span class="s1">&#39;FVA min&#39;</span><span class="p">,</span> <span class="s1">&#39;FVA max&#39;</span><span class="p">,</span> <span class="s1">&#39;FVA span&#39;</span><span class="p">,</span> <span class="s1">&#39;exchange&#39;</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">,</span> <span class="s1">&#39;stoichiometry&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Scol</span><span class="p">)):</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s_</span><span class="p">,</span> <span class="n">Scol</span><span class="p">[</span><span class="n">s_</span><span class="p">],</span> <span class="n">styleBoldC</span><span class="p">)</span>

    <span class="c1"># metabolites</span>
    <span class="n">Mlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Mcols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span><span class="s1">&#39;chemformula&#39;</span><span class="p">,</span><span class="s1">&#39;compartment&#39;</span><span class="p">,</span><span class="s1">&#39;fixed&#39;</span><span class="p">]</span>
    <span class="c1">#Mcols = [&#39;id&#39;,&#39;name&#39;,&#39;charge&#39;,&#39;chemformula&#39;,&#39;compartment&#39;,&#39;fixed&#39;,&#39;bgid&#39;]</span>
    <span class="n">MUcols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">MiriQual</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;is&quot;</span><span class="p">,</span><span class="s2">&quot;isEncodedBy&quot;</span><span class="p">,</span><span class="s2">&quot;encodes&quot;</span><span class="p">,</span><span class="s2">&quot;hasPart&quot;</span><span class="p">,</span><span class="s2">&quot;hasProperty&quot;</span><span class="p">,</span><span class="s2">&quot;hasTaxon&quot;</span><span class="p">,</span><span class="s2">&quot;hasVersion&quot;</span><span class="p">,</span><span class="s2">&quot;isDescribedBy&quot;</span><span class="p">,</span>\
                <span class="s2">&quot;isHomologTo&quot;</span><span class="p">,</span><span class="s2">&quot;isPartOf&quot;</span><span class="p">,</span><span class="s2">&quot;isPropertyOf&quot;</span><span class="p">,</span><span class="s2">&quot;isVersionOf&quot;</span><span class="p">,</span><span class="s2">&quot;occursIn&quot;</span><span class="p">]</span>
    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">styleBoldC</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">q_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MiriQual</span><span class="p">)):</span>
        <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">MiriQual</span><span class="p">[</span><span class="n">q_</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>

    <span class="c1"># get data</span>
    <span class="n">mcntr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
        <span class="n">Mdi</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getCharge</span><span class="p">()</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;chemformula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getChemFormula</span><span class="p">()</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">compartment</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;fixed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">is_boundary</span>
        <span class="c1">#Mdi[&#39;bgid&#39;] = bgGen.next()</span>
        <span class="n">udata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">MUcols</span><span class="p">:</span>
                <span class="n">MUcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>
            <span class="n">udata</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">udata</span>
        <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;reagentof&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">isReagentOf</span><span class="p">()</span>
        <span class="n">Mlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Mdi</span><span class="p">)</span>

        <span class="c1">## TODO: removed for now will appear in its own sheet at some point</span>
        <span class="c1">#wsSol.write(s_+1, 0,  Mdi[&#39;id&#39;])</span>
        <span class="c1">#Sval = fba.species[s_].getValue()</span>
        <span class="c1">#if Sval == None or numpy.isnan(Sval) or numpy.isinf(Sval):</span>
            <span class="c1">#Sval = &#39;&#39;</span>
        <span class="c1">#wsSol.write(s_+1, 1,  Sval)</span>
        <span class="c1">#wsSol.write(s_+1, 2,  fba.species[s_].shadow_price)</span>
        <span class="n">annot</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span><span class="o">.</span><span class="n">getMIRIAMannotations</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">annot</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">k_</span><span class="p">]:</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Mdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="c1">#if &#39;identifiers.org&#39; in m_:</span>
                        <span class="c1">#wsMiriam.write(mcntr, MiriQual.index(k_)+1, xlwt.Formula(&#39;HYPERLINK(&quot;{}&quot;;&quot;{}&quot;)&#39;.format(m_.replace(&#39;identifiers.org&#39;, &#39;info.identifiers.org&#39;),\</span>
                                                                                                <span class="c1">#m_.rsplit(&#39;/&#39;,1)[1])), styleHyper)</span>
                    <span class="c1">#else:</span>
                        <span class="c1">#wsMiriam.write(mcntr, MiriQual.index(k_)+1, m_)</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="n">MiriQual</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m_</span><span class="p">)</span>
                    <span class="n">mcntr</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># reactions</span>
    <span class="n">Rlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1">#Rcols = [&#39;id&#39;,&#39;name&#39;,&#39;reversible&#39;,&#39;lowerbound&#39;,&#39;upperbound&#39;,&#39;compartment&#39;,&#39;bgid&#39;]</span>
    <span class="n">Rcols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;reversible&#39;</span><span class="p">,</span><span class="s1">&#39;lowerbound&#39;</span><span class="p">,</span><span class="s1">&#39;upperbound&#39;</span><span class="p">,</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span>
    <span class="n">RUcols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">AOIDS</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getActiveObjective</span><span class="p">()</span><span class="o">.</span><span class="n">getFluxObjectiveReactions</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">AOIDS</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rids</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
    <span class="n">rids</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">)):</span>
        <span class="n">Rdi</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">REAC</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">rids</span><span class="p">[</span><span class="n">r_</span><span class="p">])</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;reversible&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">reversible</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;compartment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">compartment</span>
        <span class="c1">#Rdi[&#39;bgid&#39;] = bgGen.next()</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;lowerbound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionLowerBound</span><span class="p">(</span><span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;upperbound&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionUpperBound</span><span class="p">(</span><span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">udata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">REAC</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">REAC</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RUcols</span><span class="p">:</span>
                    <span class="n">RUcols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>
                <span class="n">udata</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">udata</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">prods</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rr_</span> <span class="ow">in</span> <span class="n">REAC</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rr_</span><span class="o">.</span><span class="n">getCoefficient</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">prods</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">rr_</span><span class="o">.</span><span class="n">getCoefficient</span><span class="p">()),</span> <span class="n">rr_</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">rr_</span><span class="o">.</span><span class="n">getCoefficient</span><span class="p">()),</span> <span class="n">rr_</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">()))</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;substrates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subs</span>
        <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;products&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prods</span>
        <span class="n">Rlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Rdi</span><span class="p">)</span>
        <span class="n">cstart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bnds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fba</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
        <span class="c1"># deal with equality</span>
        <span class="k">if</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">bnds</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">AOIDS</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="p">,</span>  <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="p">,</span>  <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span>
        <span class="n">rval</span> <span class="o">=</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">rval</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">)</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">rval</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">rval</span>

        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">bnds</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">bnds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">REAC</span><span class="o">.</span><span class="n">reduced_cost</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">REAC</span><span class="o">.</span><span class="n">fva_min</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">REAC</span><span class="o">.</span><span class="n">fva_min</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">REAC</span><span class="o">.</span><span class="n">fva_max</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">REAC</span><span class="o">.</span><span class="n">fva_max</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">REAC</span><span class="o">.</span><span class="n">fva_min</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">REAC</span><span class="o">.</span><span class="n">fva_max</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">REAC</span><span class="o">.</span><span class="n">fva_max</span><span class="o">-</span><span class="n">REAC</span><span class="o">.</span><span class="n">fva_min</span><span class="p">,</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">REAC</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">:</span>
            <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">)</span>
        <span class="c1">#else:</span>
            <span class="c1">#wsSol.write(r_+1, cstart+8, &#39;no&#39;)</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">9</span><span class="p">,</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Formula</span><span class="p">(</span><span class="s1">&#39;HYPERLINK(&quot;#reactions!A</span><span class="si">{}</span><span class="s1">&quot;;&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;info&#39;</span><span class="p">)),</span> <span class="n">styleHyper</span><span class="p">)</span>
        <span class="n">wsSol</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">cstart</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">xlwt</span><span class="o">.</span><span class="n">Formula</span><span class="p">(</span><span class="s1">&#39;HYPERLINK(&quot;#network_react!A</span><span class="si">{}</span><span class="s1">&quot;;&quot;</span><span class="si">{}</span><span class="s1">&quot;)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(((</span><span class="n">r_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;stoich&#39;</span><span class="p">)),</span> <span class="n">styleHyper</span><span class="p">)</span>

        <span class="n">annot</span> <span class="o">=</span> <span class="n">REAC</span><span class="o">.</span><span class="n">getMIRIAMannotations</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">annot</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">k_</span><span class="p">]:</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Rdi</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
                    <span class="c1">#if &#39;identifiers.org&#39; in m_:</span>
                        <span class="c1">#wsMiriam.write(mcntr, MiriQual.index(k_)+1, xlwt.Formula(&#39;HYPERLINK(&quot;{}&quot;;&quot;{}&quot;)&#39;.format(m_.replace(&#39;identifiers.org&#39;, &#39;info.identifiers.org&#39;),\</span>
                                                                                                <span class="c1">#m_.rsplit(&#39;/&#39;,1)[1])), styleHyper)</span>
                    <span class="c1">#else:</span>
                        <span class="c1">#wsMiriam.write(mcntr, MiriQual.index(k_)+1, m_)</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="n">MiriQual</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m_</span><span class="p">)</span>
                    <span class="n">mcntr</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="n">compHead</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;# species&#39;</span><span class="p">,</span> <span class="s1">&#39;# reactions&#39;</span><span class="p">]</span>
    <span class="n">compHeadU</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">compHead</span><span class="p">)):</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">compHead</span><span class="p">[</span><span class="n">c_</span><span class="p">],</span> <span class="n">styleBoldC</span><span class="p">)</span>
    <span class="n">ridx</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">c_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c_</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c_</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">c_</span><span class="o">.</span><span class="n">getSize</span><span class="p">(),</span> <span class="n">roundoff</span><span class="p">))</span>

        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">c_</span><span class="o">.</span><span class="n">getDimensions</span><span class="p">())</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">c_</span><span class="o">.</span><span class="n">containsSpecies</span><span class="p">()))</span>
        <span class="n">cRe</span> <span class="o">=</span> <span class="n">c_</span><span class="o">.</span><span class="n">containsReactions</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cRe</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cRe</span><span class="p">))</span>

        <span class="n">annot</span> <span class="o">=</span> <span class="n">c_</span><span class="o">.</span><span class="n">getAnnotations</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">compHeadU</span><span class="p">:</span>
                <span class="n">compHeadU</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">:</span>
            <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">compHeadU</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k_</span><span class="p">),</span> <span class="n">annot</span><span class="p">[</span><span class="n">k_</span><span class="p">])</span>

        <span class="n">annot</span> <span class="o">=</span> <span class="n">c_</span><span class="o">.</span><span class="n">getMIRIAMannotations</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">annot</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="n">annot</span><span class="p">[</span><span class="n">k_</span><span class="p">]:</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">c_</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
                    <span class="n">wsMiriam</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mcntr</span><span class="p">,</span> <span class="n">MiriQual</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">m_</span><span class="p">)</span>
                    <span class="n">mcntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">ud_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">compHeadU</span><span class="p">)):</span>
        <span class="n">wsComp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">+</span><span class="n">ud_</span><span class="p">,</span> <span class="n">compHeadU</span><span class="p">[</span><span class="n">ud_</span><span class="p">],</span> <span class="n">styleItalicC</span><span class="p">)</span>
    <span class="n">ridx</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">del</span> <span class="n">ridx</span><span class="p">,</span> <span class="n">c_</span>

    <span class="c1"># write data</span>
    <span class="c1"># write metabolites</span>
    <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Mcols</span><span class="p">)):</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m_</span><span class="p">,</span> <span class="n">Mcols</span><span class="p">[</span><span class="n">m_</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">MUcols</span><span class="p">)):</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mcols</span><span class="p">)</span><span class="o">+</span><span class="n">m_</span><span class="p">,</span> <span class="n">MUcols</span><span class="p">[</span><span class="n">m_</span><span class="p">],</span> <span class="n">styleItalic</span><span class="p">)</span>
    <span class="n">stridx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Mlist</span><span class="p">)):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s_</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;charge&#39;</span><span class="p">])</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;chemformula&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;chemformula&#39;</span><span class="p">])</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;compartment&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;compartment&#39;</span><span class="p">])</span>
        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">Mcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;fixed&#39;</span><span class="p">),</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;fixed&#39;</span><span class="p">])</span>
        <span class="c1">#wsMet.write(s, Mcols.index(&#39;bgid&#39;), Mlist[s_][&#39;bgid&#39;])</span>
        <span class="k">for</span> <span class="n">ud_</span> <span class="ow">in</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">30000</span><span class="p">:</span>
                        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mcols</span><span class="p">)</span><span class="o">+</span><span class="n">MUcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ud_</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">wsMet</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Mcols</span><span class="p">)</span><span class="o">+</span><span class="n">MUcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ud_</span><span class="p">),</span><span class="s1">&#39;Data too long (more than 30000 characters)&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Annotation write error (TypeError) </span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ud_</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">]))</span>

        <span class="n">wsStR</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stridx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ro_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;reagentof&#39;</span><span class="p">])):</span>
            <span class="n">wsStR</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stridx</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span> <span class="n">Mlist</span><span class="p">[</span><span class="n">s_</span><span class="p">][</span><span class="s1">&#39;reagentof&#39;</span><span class="p">][</span><span class="n">ro_</span><span class="p">])</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cidx</span> <span class="o">&gt;=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">stridx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">stridx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># write reactions</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rcols</span><span class="p">)):</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r_</span><span class="p">,</span> <span class="n">Rcols</span><span class="p">[</span><span class="n">r_</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RUcols</span><span class="p">)):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rcols</span><span class="p">)</span><span class="o">+</span><span class="n">r_</span><span class="p">,</span> <span class="n">RUcols</span><span class="p">[</span><span class="n">r_</span><span class="p">],</span> <span class="n">styleItalic</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">why</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">why</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: Exceeded Excel columns&#39;</span><span class="p">)</span>
    <span class="n">ridx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rlist</span><span class="p">)):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r_</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">),</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;reversible&#39;</span><span class="p">),</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;reversible&#39;</span><span class="p">])</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;lowerbound&#39;</span><span class="p">),</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;lowerbound&#39;</span><span class="p">],</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;upperbound&#39;</span><span class="p">),</span> <span class="n">convertFloatToExcel</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;upperbound&#39;</span><span class="p">],</span> <span class="n">roundoff</span><span class="p">))</span>
        <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">Rcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;compartment&#39;</span><span class="p">),</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;compartment&#39;</span><span class="p">])</span>
        <span class="c1">#wsRe.write(r, Rcols.index(&#39;bgid&#39;), Rlist[r_][&#39;bgid&#39;])</span>
        <span class="k">for</span> <span class="n">ud_</span> <span class="ow">in</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">]</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rcols</span><span class="p">)</span><span class="o">+</span><span class="n">RUcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ud_</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">30000</span><span class="p">:</span>
                <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rcols</span><span class="p">)</span><span class="o">+</span><span class="n">RUcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ud_</span><span class="p">),</span> <span class="s1">&#39;Data too long (more than 30000 characters)&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">wsRe</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Rcols</span><span class="p">)</span><span class="o">+</span><span class="n">RUcols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ud_</span><span class="p">),</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="n">ud_</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exceeded Excel columns&#39;</span><span class="p">)</span>

        <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;substrates&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="n">cidx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">sr_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;substrates&#39;</span><span class="p">])):</span>
            <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="n">sr_</span><span class="p">,</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;substrates&#39;</span><span class="p">][</span><span class="n">sr_</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="n">sr_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;substrates&#39;</span><span class="p">][</span><span class="n">sr_</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;products&#39;</span><span class="p">,</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="n">cidx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">pr_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;products&#39;</span><span class="p">])):</span>
            <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="n">pr_</span><span class="p">,</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="n">pr_</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">wsSt</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ridx</span><span class="p">,</span> <span class="n">cidx</span><span class="o">+</span><span class="n">pr_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Rlist</span><span class="p">[</span><span class="n">r_</span><span class="p">][</span><span class="s1">&#39;products&#39;</span><span class="p">][</span><span class="n">pr_</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cidx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">ridx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">gids</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getGroupIds</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">g_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gids</span><span class="p">)):</span>
        <span class="n">mbrs</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">gids</span><span class="p">[</span><span class="n">g_</span><span class="p">])</span><span class="o">.</span><span class="n">getMemberIDs</span><span class="p">()</span>
        <span class="n">wsGrp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">g_</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gids</span><span class="p">[</span><span class="n">g_</span><span class="p">],</span> <span class="n">fba</span><span class="o">.</span><span class="n">getGroup</span><span class="p">(</span><span class="n">gids</span><span class="p">[</span><span class="n">g_</span><span class="p">])</span><span class="o">.</span><span class="n">getName</span><span class="p">()),</span> <span class="n">styleBold</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mbrs</span><span class="p">)):</span>
            <span class="n">wsGrp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">m_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">g_</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">mbrs</span><span class="p">[</span><span class="n">m_</span><span class="p">]))</span>

    <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">.xls&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span></div>

<div class="viewcode-block" id="writeModelToCOMBINEarchive"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBWrite.writeModelToCOMBINEarchive">[docs]</a><span class="k">def</span> <span class="nf">writeModelToCOMBINEarchive</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sbmlname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">withExcel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">vc_given</span><span class="o">=</span><span class="s1">&#39;CBMPy&#39;</span><span class="p">,</span> <span class="n">vc_family</span><span class="o">=</span><span class="s1">&#39;Software&#39;</span><span class="p">,</span> <span class="n">vc_email</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">vc_org</span><span class="o">=</span><span class="s1">&#39;cbmpy.sourceforge.net&#39;</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a model in SBML and Excel format to a COMBINE archive using the following information:</span>

<span class="sd">    - *mod* a model object</span>
<span class="sd">    - *fname* the output base filename, archive will be &lt;fname&gt;.zip</span>
<span class="sd">    - *directory* [default=None] created the combine archive &#39;directory&#39;</span>
<span class="sd">    - *sbmlname* [default=&#39;None&#39;] If *sbmlname* is defined then SBML file is &lt;sbmlname&gt;.xml otherwise sbml will be &lt;fname&gt;.xml.</span>
<span class="sd">    - *withExcel* [default=True] include a human readable Excel spreadsheet version of the model</span>
<span class="sd">    - *vc_given* [default=&#39;CBMPy&#39;] first name</span>
<span class="sd">    - *vc_family* [default=&#39;Software&#39;] family name</span>
<span class="sd">    - *vc_email* [default=&#39;None&#39;] email</span>
<span class="sd">    - *vc_org* [default=&#39;None&#39;] organisation</span>
<span class="sd">    - *add_cbmpy_annot* [default=True] add CBMPy KeyValueData annotation. Replaces &lt;notes&gt;</span>
<span class="sd">    - *add_cobra_annot* [default=True] add COBRA &lt;notes&gt; annotation</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%S&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">%i</span><span class="s1">:00&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">timezone</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span>
    <span class="c1">#self.writeSedXML(sedx=True)</span>
    <span class="c1">#sedxname = &#39;%s.sed.omex&#39; % (self.id)</span>
    <span class="c1">#sf = os.path.join(self.sedpath, sedxname)</span>
    <span class="c1">#self.__sedarchive__ = sf</span>
    <span class="k">if</span> <span class="n">directory</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">zfpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.sbex.zip&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">zfpath</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.sbex.zip&#39;</span>
    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zfpath</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sbmlname</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sbmlname</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.xml&#39;</span><span class="p">):</span>
            <span class="n">sbmlf</span> <span class="o">=</span> <span class="n">sbmlname</span>
            <span class="n">xlf</span> <span class="o">=</span> <span class="n">sbmlname</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sbmlf</span> <span class="o">=</span> <span class="n">sbmlname</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
            <span class="n">xlf</span> <span class="o">=</span> <span class="n">sbmlname</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sbmlf</span> <span class="o">=</span> <span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.xml&#39;</span>
        <span class="n">xlf</span> <span class="o">=</span> <span class="n">fname</span>
    <span class="n">ptmp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;sedxtmp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ptmp</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">ptmp</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ptmp</span><span class="p">),</span> <span class="s2">&quot;Could not create temporary archive directory: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ptmp</span><span class="p">)</span>

    <span class="n">MFstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">MDstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">MFstr</span> <span class="o">+=</span> <span class="s1">&#39;&lt;omexManifest xmlns=&quot;http://identifiers.org/combine.specifications/omex-manifest&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MFstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;content location=&quot;.&quot; format=&quot;http://identifiers.org/combine.specifications/omex&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="c1">#MFstr += &#39; &lt;content location=&quot;./%s&quot; format=&quot;http://identifiers.org/combine.specifications/sedml&quot;/&gt;\n&#39; % os.path.split(self.__sedxml__)[-1]</span>
    <span class="n">MFstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;content location=&quot;./metadata.rdf&quot; format=&quot;http://identifiers.org/combine.specifications/omex-metadata&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>

    <span class="c1"># SBML</span>
    <span class="n">writeSBML3FBCV2</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">sbmlf</span><span class="p">,</span> <span class="n">ptmp</span><span class="p">,</span> <span class="n">add_cbmpy_annot</span><span class="o">=</span><span class="n">add_cbmpy_annot</span><span class="p">,</span> <span class="n">add_cobra_annot</span><span class="o">=</span><span class="n">add_cobra_annot</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="n">sbmlf</span><span class="p">),</span> <span class="n">arcname</span><span class="o">=</span><span class="n">sbmlf</span><span class="p">)</span>
    <span class="n">MFstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;content location=&quot;./</span><span class="si">{}</span><span class="s1">&quot; format=&quot;http://identifiers.org/combine.specifications/sbml.level-3.version-1&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sbmlf</span><span class="p">)</span>

    <span class="c1"># Excel</span>
    <span class="k">if</span> <span class="n">withExcel</span> <span class="ow">and</span> <span class="n">_HAVE_XLWT_</span><span class="p">:</span>
        <span class="n">writeModelToExcel97</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="n">xlf</span><span class="p">))</span>
        <span class="n">xlf</span> <span class="o">+=</span> <span class="s1">&#39;.xls&#39;</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="n">xlf</span><span class="p">),</span> <span class="n">arcname</span><span class="o">=</span><span class="n">xlf</span><span class="p">)</span>
        <span class="n">MFstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;content location=&quot;./</span><span class="si">{}</span><span class="s1">&quot; format=&quot;http://mediatypes.appspot.com/application/vnd.ms-excel&quot;/&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xlf</span><span class="p">)</span>
    <span class="n">MF</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="s1">&#39;manifest.xml&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">MF</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&lt;/omexManifest&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MFstr</span><span class="p">))</span>
    <span class="n">MF</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="n">MD</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="s1">&#39;metadata.rdf&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;rdf:RDF xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    xmlns:vCard=&quot;http://www.w3.org/2006/vcard/ns#&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    xmlns:bqmodel=&quot;http://biomodels.net/models-qualifiers&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;rdf:Description rdf:about=&quot;.&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1">#MDstr += &#39;   &lt;dcterms:description&gt;\n     %s\n    &lt;/dcterms:description&gt;\n&#39; % self.omex_description</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;dcterms:creator&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;rdf:Bag&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;rdf:li rdf:parseType=&quot;Resource&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;vCard:hasName rdf:parseType=&quot;Resource&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;vCard:family-name&gt;</span><span class="si">{}</span><span class="s1">&lt;/vCard:family-name&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vc_family</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;vCard:given-name&gt;</span><span class="si">{}</span><span class="s1">&lt;/vCard:given-name&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vc_given</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;/vCard:hasName&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;vCard:hasEmail rdf:resource=&quot;</span><span class="si">{}</span><span class="s1">&quot; /&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vc_email</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;vCard:organization-name&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;      </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vc_org</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;/vCard:organization-name&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;  &lt;/rdf:li&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;/rdf:Bag&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39; &lt;/dcterms:creator&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;dcterms:created rdf:parseType=&quot;Resource&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;dcterms:W3CDTF&gt;</span><span class="si">{}</span><span class="s1">&lt;/dcterms:W3CDTF&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scTime</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;/dcterms:created&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;dcterms:modified rdf:parseType=&quot;Resource&quot;&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;    &lt;dcterms:W3CDTF&gt;</span><span class="si">{}</span><span class="s1">&lt;/dcterms:W3CDTF&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">scTime</span><span class="p">)</span>
    <span class="n">MDstr</span> <span class="o">+=</span> <span class="s1">&#39;   &lt;/dcterms:modified&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MDstr</span><span class="p">))</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39; &lt;/rdf:Description&gt;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;&lt;/rdf:RDF&gt; </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">MD</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="s1">&#39;manifest.xml&#39;</span><span class="p">),</span> <span class="n">arcname</span><span class="o">=</span><span class="s1">&#39;manifest.xml&#39;</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="s1">&#39;metadata.rdf&#39;</span><span class="p">),</span> <span class="n">arcname</span><span class="o">=</span><span class="s1">&#39;metadata.rdf&#39;</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">ptmp</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ptmp</span><span class="p">,</span> <span class="n">f_</span><span class="p">))</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">removedirs</span><span class="p">(</span><span class="n">ptmp</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">WindowsError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;COMBINE archive created: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.zip&#39;</span><span class="p">))</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../cbmpy.html">
              <img class="logo" src="../../_static/pysces_cbm1_head.jpg" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../cbmpy.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2010-2018, Brett G. Olivier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>