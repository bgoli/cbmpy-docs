
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>cbmpy.CBTools &#8212; CBMPy 0.7.20 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.7.20',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within CBMPy 0.7.20 documentation"
          href="../../_static/opensearch.xml"/>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cbmpy.CBTools</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">CBMPy: CBTools module</span>
<span class="sd">=====================</span>
<span class="sd">PySCeS Constraint Based Modelling (http://cbmpy.sourceforge.net)</span>
<span class="sd">Copyright (C) 2009-2017 Brett G. Olivier, VU University Amsterdam, Amsterdam, The Netherlands</span>

<span class="sd">This program is free software: you can redistribute it and/or modify</span>
<span class="sd">it under the terms of the GNU General Public License as published by</span>
<span class="sd">the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">(at your option) any later version.</span>

<span class="sd">This program is distributed in the hope that it will be useful,</span>
<span class="sd">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="sd">GNU General Public License for more details.</span>

<span class="sd">You should have received a copy of the GNU General Public License</span>
<span class="sd">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;</span>

<span class="sd">Author: Brett G. Olivier</span>
<span class="sd">Contact email: bgoli@users.sourceforge.net</span>
<span class="sd">Last edit: $Author: bgoli $ ($Id: CBTools.py 622 2017-09-13 12:56:30Z bgoli $)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">## gets rid of &quot;invalid variable name&quot; info</span>
<span class="c1"># pylint: disable=C0103</span>
<span class="c1">## gets rid of &quot;line to long&quot; info</span>
<span class="c1"># pylint: disable=C0301</span>
<span class="c1">## use with caution: gets rid of module xxx has no member errors (run once enabled)</span>
<span class="c1"># pylint: disable=E1101</span>


<span class="c1"># preparing for Python 3 port</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="c1">#from __future__ import unicode_literals</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">re</span><span class="o">,</span> <span class="nn">pprint</span><span class="o">,</span> <span class="nn">gzip</span><span class="o">,</span> <span class="nn">zipfile</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cPickle</span> <span class="k">as</span> <span class="nn">pickle</span>
<span class="n">cDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">CBModel</span>
<span class="c1">#from .CBDataStruct import StructMatrixLP # legacy</span>
<span class="kn">from</span> <span class="nn">.CBCommon</span> <span class="k">import</span> <span class="n">HAVE_PYPARSING</span><span class="p">,</span> <span class="n">checkChemFormula</span><span class="p">,</span> <span class="n">pp_chemicalFormula</span><span class="p">,</span> <span class="n">extractGeneIdsFromString</span>
<span class="kn">from</span> <span class="nn">.CBCommon</span> <span class="k">import</span> <span class="n">processSpeciesChargeChemFormulaAnnot</span><span class="p">,</span> <span class="n">pyparsing</span>

<span class="n">_PPR_</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">PrettyPrinter</span><span class="p">()</span>


<span class="kn">from</span> <span class="nn">.CBConfig</span> <span class="k">import</span> <span class="n">__CBCONFIG__</span> <span class="k">as</span> <span class="n">__CBCONFIG__</span>
<span class="n">__DEBUG__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="n">__CBCONFIG__</span><span class="p">[</span><span class="s1">&#39;VERSION&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="createTempFileName"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.createTempFileName">[docs]</a><span class="k">def</span> <span class="nf">createTempFileName</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a temporary filename</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<span class="c1">#TODO comrpess</span>
<div class="viewcode-block" id="storeObj"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.storeObj">[docs]</a><span class="k">def</span> <span class="nf">storeObj</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Stores a Python *obj* as a serialised binary object in *filename*.dat</span>

<span class="sd">    - *obj* a python object</span>
<span class="sd">    - *filename* the base filename</span>
<span class="sd">    - *compress* [False] use gzip compression not *implemented*</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;.dat&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Object serialised as </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="loadObj"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.loadObj">[docs]</a><span class="k">def</span> <span class="nf">loadObj</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a serialised Python pickle from *filename*.dat returns the Python object(s)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">filename</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="s1">&#39;.dat&#39;</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">+</span><span class="s1">&#39;.dat&#39;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">File </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="deSerialize"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.deSerialize">[docs]</a><span class="k">def</span> <span class="nf">deSerialize</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Deserializes a serialised object contained in a string</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></div>

<div class="viewcode-block" id="deSerializeFromDisk"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.deSerializeFromDisk">[docs]</a><span class="k">def</span> <span class="nf">deSerializeFromDisk</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Loads a serialised Python pickle from *filename* returns the Python object(s)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">File </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="addStoichToFBAModel"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.addStoichToFBAModel">[docs]</a><span class="k">def</span> <span class="nf">addStoichToFBAModel</span><span class="p">(</span><span class="n">fm</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Build stoichiometry: this method has been refactored into the model class - cmod.buildStoichMatrix()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">buildStoichMatrix</span><span class="p">()</span></div>

<div class="viewcode-block" id="addSinkReaction"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.addSinkReaction">[docs]</a><span class="k">def</span> <span class="nf">addSinkReaction</span><span class="p">(</span><span class="n">fbam</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a sink reactions that consumes a model *species* so that X --&gt;</span>

<span class="sd">     - *fbam* an fba model object</span>
<span class="sd">     - *species* a valid species name</span>
<span class="sd">     - *lb* lower flux bound [default = 0.0]</span>
<span class="sd">     - *ub* upper flux bound [default = 1000.0]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">fbam</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> is not a valid species&#39;</span> <span class="o">%</span> <span class="n">species</span>
    <span class="k">if</span> <span class="n">lb</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">reversible</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reversible</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">Rname</span> <span class="o">=</span> <span class="n">species</span><span class="o">+</span><span class="s1">&#39;_sink&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">Rname</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> sink reaction&#39;</span> <span class="o">%</span> <span class="n">species</span><span class="p">,</span> <span class="n">reversible</span><span class="o">=</span><span class="n">reversible</span><span class="p">)</span>
    <span class="n">Su</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reagent</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">addReagent</span><span class="p">(</span><span class="n">Su</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">clb</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="s1">&#39;_lb&#39;</span><span class="p">,</span> <span class="n">Rname</span><span class="p">,</span> <span class="s1">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
    <span class="n">cub</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="s1">&#39;_ub&#39;</span><span class="p">,</span> <span class="n">Rname</span><span class="p">,</span> <span class="s1">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>

    <span class="n">fbam</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">create_default_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">clb</span><span class="p">)</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">cub</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***</span><span class="se">\n</span><span class="s1">Created new reaction </span><span class="si">{}</span><span class="s1"> with bounds (</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">***</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rname</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">))</span></div>


<span class="c1"># TODO: check this</span>
<div class="viewcode-block" id="addSourceReaction"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.addSourceReaction">[docs]</a><span class="k">def</span> <span class="nf">addSourceReaction</span><span class="p">(</span><span class="n">fbam</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a source reactions that produces a model *species* so that --&gt; X</span>

<span class="sd">     - *fbam* an fba model object</span>
<span class="sd">     - *species* a valid species name</span>
<span class="sd">     - *lb* lower flux bound [default = 0.0]</span>
<span class="sd">     - *ub* upper flux bound [default = 1000.0]</span>

<span class="sd">    Note reversiblity is determined by the lower bound, default 0 = irreversible. If</span>
<span class="sd">    negative then reversible.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">fbam</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">(),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> is not a valid species&#39;</span> <span class="o">%</span> <span class="n">species</span>
    <span class="k">if</span> <span class="n">lb</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">reversible</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">reversible</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">Rname</span> <span class="o">=</span> <span class="n">species</span><span class="o">+</span><span class="s1">&#39;_src&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reaction</span><span class="p">(</span><span class="n">Rname</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> source reaction&#39;</span> <span class="o">%</span> <span class="n">species</span><span class="p">,</span> <span class="n">reversible</span><span class="o">=</span><span class="n">reversible</span><span class="p">)</span>
    <span class="n">Su</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Reagent</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="n">species</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">addReagent</span><span class="p">(</span><span class="n">Su</span><span class="p">)</span>
    <span class="n">R</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">clb</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="s1">&#39;_lb&#39;</span><span class="p">,</span> <span class="n">Rname</span><span class="p">,</span> <span class="s1">&#39;greaterEqual&#39;</span><span class="p">,</span> <span class="n">lb</span><span class="p">)</span>
    <span class="n">cub</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxBound</span><span class="p">(</span><span class="n">Rname</span><span class="o">+</span><span class="s1">&#39;_ub&#39;</span><span class="p">,</span> <span class="n">Rname</span><span class="p">,</span> <span class="s1">&#39;lessEqual&#39;</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>

    <span class="n">fbam</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">create_default_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">clb</span><span class="p">)</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">cub</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***</span><span class="se">\n</span><span class="s1">Created new reaction </span><span class="si">{}</span><span class="s1"> with bounds (</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">***</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Rname</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">))</span></div>

<div class="viewcode-block" id="findDeadEndMetabolites"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.findDeadEndMetabolites">[docs]</a><span class="k">def</span> <span class="nf">findDeadEndMetabolites</span><span class="p">(</span><span class="n">fbam</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds dead-end (single reaction) metabolites rows in N with a single entry), returns a list of (metabolite, reaction) ids</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">buildStoichMatrix</span><span class="p">()</span>
    <span class="n">orphaned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span> <span class="p">:]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">rr</span><span class="p">,:])</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">rr</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">rr</span><span class="p">,</span><span class="n">c</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">orphaned_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">rr</span><span class="p">],</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">c</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">orphaned_list</span></div>

<div class="viewcode-block" id="findDeadEndReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.findDeadEndReactions">[docs]</a><span class="k">def</span> <span class="nf">findDeadEndReactions</span><span class="p">(</span><span class="n">fbam</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds dead-end (single substrate/product) reactions (cols in N with a single entry), returns a list of (metabolite, reaction) ids</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fbam</span><span class="o">.</span><span class="n">buildStoichMatrix</span><span class="p">()</span>
    <span class="n">orphaned_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="n">cc</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="n">cc</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">cc</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">cc</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">orphaned_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">row</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">fbam</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">col</span><span class="p">[</span><span class="n">cc</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">orphaned_list</span></div>

<div class="viewcode-block" id="setSpeciesPropertiesFromAnnotations"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.setSpeciesPropertiesFromAnnotations">[docs]</a><span class="k">def</span> <span class="nf">setSpeciesPropertiesFromAnnotations</span><span class="p">(</span><span class="n">fbam</span><span class="p">,</span> <span class="n">overwriteCharge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwriteChemFormula</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This will attempt to set the model Species properties from the annotation. With the default options</span>
<span class="sd">    it will only replace missing data. With ChemicalFormula this is easy to detect however charge may</span>
<span class="sd">    have an &quot;unknown value&quot; of 0. Setting the optional values to true will replace any existing value</span>
<span class="sd">    with any valid annotation.</span>

<span class="sd">     - *overwriteChemFormula* [default=False]</span>
<span class="sd">     - *overwriteCharge* [default=False]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="n">fbam</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">processSpeciesChargeChemFormulaAnnot</span><span class="p">(</span><span class="n">s_</span><span class="p">,</span> <span class="n">getFromName</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwriteCharge</span><span class="o">=</span><span class="n">overwriteCharge</span><span class="p">,</span> <span class="n">overwriteChemFormula</span><span class="o">=</span><span class="n">overwriteChemFormula</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;processSpeciesChargeChemFormulaAnnot failed for species with id: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s_</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span></div>

<div class="viewcode-block" id="fixReversibility"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.fixReversibility">[docs]</a><span class="k">def</span> <span class="nf">fixReversibility</span><span class="p">(</span><span class="n">fbam</span><span class="p">,</span> <span class="n">auto_correct</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set fluxbound lower bound from reactions reversibility information.</span>

<span class="sd">     - *fbam* and FBAModel instance</span>
<span class="sd">     - *auto_correct* (default=False) if True automatically sets lower bound to zero if required, otherwise prints a warning if false.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">fbam</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">reaction</span>
        <span class="c1">##  print R</span>
        <span class="n">O</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">operation</span>
        <span class="c1">##  print O</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">value</span>
        <span class="c1">##  print V</span>
        <span class="n">R_obj</span> <span class="o">=</span> <span class="n">fbam</span><span class="o">.</span><span class="n">reactions</span><span class="p">[</span><span class="n">fbam</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">reaction</span><span class="p">)]</span>
        <span class="n">RE</span> <span class="o">=</span> <span class="n">R_obj</span><span class="o">.</span><span class="n">reversible</span>
        <span class="c1">##  print RE</span>
        <span class="k">if</span> <span class="n">O</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;greater&#39;</span><span class="p">,</span> <span class="s1">&#39;greaterEqual&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">RE</span> <span class="ow">and</span> <span class="nb">float</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning </span><span class="si">{}</span><span class="s1"> is not reversible and lower bound is </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">auto_correct</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resetting </span><span class="si">{}</span><span class="s1"> lower bound (</span><span class="si">{}</span><span class="s1">) to zero&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
                    <span class="n">c</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reaction (</span><span class="si">{}</span><span class="s1">) reversible=</span><span class="si">{}</span><span class="s1"> inconsistent with fluxbound lower bound (</span><span class="si">{}</span><span class="s1">) run with auto_correct=True to reset lower bound.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">RE</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="splitReversibleReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.splitReversibleReactions">[docs]</a><span class="k">def</span> <span class="nf">splitReversibleReactions</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">selected_reactions</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split a (set of) reactions into reversible reactions returns a copy of the original model</span>

<span class="sd">    R1: A = B</span>
<span class="sd">    R1f: A -&gt; B</span>
<span class="sd">    R1r: B -&gt; A</span>

<span class="sd">     - *fba* an instantiated CBMPy model object</span>
<span class="sd">     - *selected_reactions* if a reversible reaction id is in here split it</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">selected_reactions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">selected_reactions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_reactions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">selected_reactions</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">getReversibleReactionIds</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">M</span><span class="o">.</span><span class="n">getReversibleReactionIds</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">selected_reactions</span><span class="p">:</span>
            <span class="n">splitSingleReversibleReaction</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">r_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">return</span> <span class="n">M</span></div>

<div class="viewcode-block" id="splitSingleReversibleReaction"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.splitSingleReversibleReaction">[docs]</a><span class="k">def</span> <span class="nf">splitSingleReversibleReaction</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">fwd_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rev_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Split a single reversible reaction into two irreversible reactions, returns the original reversible reaction and bounds</span>
<span class="sd">    while deleting them from model.</span>

<span class="sd">    R1: A = B</span>
<span class="sd">    R1_fwd: A -&gt; B</span>
<span class="sd">    R1_rev: B -&gt; A</span>

<span class="sd">     - *fba* an instantiated CBMPy model object</span>
<span class="sd">     - *rid* a valid reaction id</span>
<span class="sd">     - *fwd_id* [default=None] the new forward reaction id, defaults to rid_fwd</span>
<span class="sd">     - *rev_id* [default=None] the new forward reaction id, defaults to rid_rev</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">R</span> <span class="o">!=</span> <span class="kc">None</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reversible reaction splitter is processing: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">))</span>
    <span class="n">Rf</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">Rb</span> <span class="o">=</span> <span class="n">R</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
    <span class="n">Rf</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s1">&#39;cbmpy_split_fwd&#39;</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
    <span class="n">Rb</span><span class="o">.</span><span class="n">setAnnotation</span><span class="p">(</span><span class="s1">&#39;cbmpy_split_rev&#39;</span><span class="p">,</span> <span class="n">rid</span><span class="p">)</span>
    <span class="n">RB</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
    <span class="n">LB</span> <span class="o">=</span> <span class="n">UB</span> <span class="o">=</span> <span class="n">EB</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">RB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">RB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">RB</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;ERROR: For reaction splitting (</span><span class="si">{}</span><span class="s1">): LowerBound (</span><span class="si">{}</span><span class="s1">) must be LessEqual to UpperBound (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">6</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">LB</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getFluxBoundByReactionID</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s1">&#39;lower&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">UB</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getFluxBoundByReactionID</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">EB</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getFluxBoundByReactionID</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="s1">&#39;equality&#39;</span><span class="p">)</span>
    <span class="n">fba</span><span class="o">.</span><span class="n">deleteReactionAndBounds</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fwd_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fwd_id</span> <span class="o">=</span> <span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_fwd&#39;</span>
    <span class="n">Rf</span><span class="o">.</span><span class="n">setPid</span><span class="p">(</span><span class="n">fwd_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rev_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">rev_id</span> <span class="o">=</span> <span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_rev&#39;</span>
    <span class="n">Rb</span><span class="o">.</span><span class="n">setPid</span><span class="p">(</span><span class="n">rev_id</span><span class="p">)</span>
    <span class="n">Rf</span><span class="o">.</span><span class="n">reversible</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">Rb</span><span class="o">.</span><span class="n">reversible</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">rr_</span> <span class="ow">in</span> <span class="n">Rf</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
        <span class="n">rr_</span><span class="o">.</span><span class="n">setPid</span><span class="p">(</span><span class="n">rr_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_fwd&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">rr_</span> <span class="ow">in</span> <span class="n">Rb</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
        <span class="n">rr_</span><span class="o">.</span><span class="n">setCoefficient</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">rr_</span><span class="o">.</span><span class="n">getCoefficient</span><span class="p">())</span>
        <span class="n">rr_</span><span class="o">.</span><span class="n">setPid</span><span class="p">(</span><span class="n">rr_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_rev&#39;</span><span class="p">)</span>
    <span class="n">fba</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">Rf</span><span class="p">,</span> <span class="n">create_default_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fba</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">Rb</span><span class="p">,</span> <span class="n">create_default_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">EB</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">EB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">EB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">EB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">EB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">LB</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">UB</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
    <span class="k">elif</span> <span class="n">LB</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">UB</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">LB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
    <span class="k">elif</span> <span class="n">LB</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">UB</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">())</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">UB</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
            <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rf</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionLowerBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">fba</span><span class="o">.</span><span class="n">createReactionUpperBound</span><span class="p">(</span><span class="n">Rb</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">LB</span><span class="p">,</span> <span class="n">UB</span><span class="p">,</span> <span class="n">EB</span><span class="p">)</span></div>

<div class="viewcode-block" id="exportLabelledArray"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArray">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a 2D array type object to file</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *names* [default=None] the list of row names</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *fmt* [default=&#39;%s&#39;] the output number format</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ...  rows must equal number of names!&#39;</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">names</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
        <span class="n">cntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cntr</span> <span class="o">&gt;=</span> <span class="mi">250</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span></div>

<div class="viewcode-block" id="exportLabelledArrayWithHeader"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArrayWithHeader">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArrayWithHeader</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array with row names and header</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *names* [default=None] the list of row names</span>
<span class="sd">     - *header* [default=None] the list of column names</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *fmt* [default=&#39;%s&#39;] the output number format</span>
<span class="sd">     - *appendlist* [default=False] if True append the array to *fname* otherwise create a new file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ...  rows must equal number of names!&#39;</span>
    <span class="k">if</span> <span class="n">header</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ...  cols must equal number of header names!&#39;</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">header</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hstr</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">sep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">hstr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">h</span><span class="p">)</span><span class="o">+</span><span class="n">sep</span>
        <span class="n">hstr</span> <span class="o">=</span> <span class="n">hstr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">hstr</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">hstr</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">names</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">])</span>
        <span class="n">cntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cntr</span> <span class="o">&gt;=</span> <span class="mi">250</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span></div>

<div class="viewcode-block" id="exportLabelledLinkedList"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledLinkedList">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledLinkedList</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">appendlist</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write a 2D linked list [[...],[...],[...],[...]] and optionally a list of row labels to file:</span>

<span class="sd">     - *arr* the linked list</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *names* [default=None] the list of row names</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>
<span class="sd">     - *fmt* [default=&#39;%s&#39;] the output number format</span>
<span class="sd">     - *appendlist* [default=False] if True append the array to *fname* otherwise create a new file</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">names</span><span class="p">),</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ...  rows must equal number of names!&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">appendlist</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">cntr</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">names</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">names</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
        <span class="n">col_l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">col_l</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">col_l</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="n">sep</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;uError&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0.0</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="n">arr</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">])</span>
                    <span class="k">except</span> <span class="ne">UnicodeEncodeError</span><span class="p">:</span>
                        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">((</span><span class="n">fmt</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="s1">&#39;uError&#39;</span><span class="p">)</span>
        <span class="n">cntr</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">cntr</span> <span class="o">&gt;=</span> <span class="mi">250</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">cntr</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="c1">##  F.write(&#39;\n&#39;)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">arr</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">appendlist</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;exported to </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fname</span><span class="p">))</span></div>

<div class="viewcode-block" id="exportLabelledArrayWithHeader2CSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArrayWithHeader2CSV">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArrayWithHeader2CSV</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array with row names and header to fname.csv</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *names* [default=None] the list of row names</span>
<span class="sd">     - *header* [default=None] the list of column names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>
    <span class="n">exportLabelledArrayWithHeader</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span>  <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="exportLabelledArray2CSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArray2CSV">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArray2CSV</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array with row names to fname.csv</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *names* [default=None] the list of row names</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>
    <span class="n">exportLabelledArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="exportArray2CSV"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportArray2CSV">[docs]</a><span class="k">def</span> <span class="nf">exportArray2CSV</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array to fname.csv</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.csv&#39;</span>
    <span class="n">exportLabelledArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="exportLabelledArrayWithHeader2TXT"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArrayWithHeader2TXT">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArrayWithHeader2TXT</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array with row names and header to fname.txt</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *names* the list of row names</span>
<span class="sd">     - *header* the list of column names</span>
<span class="sd">     - *fname* the output filename</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="n">exportLabelledArrayWithHeader</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="exportLabelledArray2TXT"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportLabelledArray2TXT">[docs]</a><span class="k">def</span> <span class="nf">exportLabelledArray2TXT</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array with row names to fname.txt</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *names* [default=None] the list of row names</span>
<span class="sd">     - *fname* the output filename</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="n">exportLabelledArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="exportArray2TXT"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.exportArray2TXT">[docs]</a><span class="k">def</span> <span class="nf">exportArray2TXT</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export an array to fname.txt</span>

<span class="sd">     - *arr* the an array like object</span>
<span class="sd">     - *fname* the output filename</span>
<span class="sd">     - *sep* [default=&#39;,&#39;] the column separator</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fname</span> <span class="o">+=</span> <span class="s1">&#39;.txt&#39;</span>
    <span class="n">exportLabelledArray</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="stringReplace"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.stringReplace">[docs]</a><span class="k">def</span> <span class="nf">stringReplace</span><span class="p">(</span><span class="n">fbamod</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is alpha stuff, target can be:</span>

<span class="sd">     - &#39;species&#39;</span>
<span class="sd">     - &#39;reactions&#39;</span>
<span class="sd">     - &#39;constraints&#39;</span>
<span class="sd">     - &#39;objectives&#39;</span>
<span class="sd">     - &#39;all&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;stringReplace is relatively new and UNTESTED&#39;</span><span class="p">)</span>
    <span class="n">fbamod</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;species&#39;</span> <span class="ow">or</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;reactions&#39;</span> <span class="ow">or</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
                <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;constraints&#39;</span> <span class="ow">or</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">reaction</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;objectives&#39;</span> <span class="ow">or</span> <span class="n">target</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">reaction</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">reaction</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fbamod</span></div>

<div class="viewcode-block" id="getBoundsDict"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.getBoundsDict">[docs]</a><span class="k">def</span> <span class="nf">getBoundsDict</span><span class="p">(</span><span class="n">fbamod</span><span class="p">,</span> <span class="n">substring</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary of reactions&amp;bounds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rBdic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">(</span><span class="n">substring</span><span class="o">=</span><span class="n">substring</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">eq</span> <span class="o">=</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">rBdic</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lb&#39;</span> <span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
                              <span class="s1">&#39;ub&#39;</span> <span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
                              <span class="s1">&#39;eq&#39;</span> <span class="p">:</span> <span class="n">eq</span>
                             <span class="p">}</span>
                    <span class="p">})</span>
    <span class="k">return</span> <span class="n">rBdic</span></div>

<div class="viewcode-block" id="getExchBoundsDict"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.getExchBoundsDict">[docs]</a><span class="k">def</span> <span class="nf">getExchBoundsDict</span><span class="p">(</span><span class="n">fbamod</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a dictionary of all exchange reactions (as determined by the is_exchange attribute of Reaction)</span>

<span class="sd">    - *fbamod* a CBMPy model</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rBdic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">(</span><span class="n">substring</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">eq</span> <span class="o">=</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">getReactionBounds</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">rBdic</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">name</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;lb&#39;</span> <span class="p">:</span> <span class="n">lb</span><span class="p">,</span>
                              <span class="s1">&#39;ub&#39;</span> <span class="p">:</span> <span class="n">ub</span><span class="p">,</span>
                              <span class="s1">&#39;eq&#39;</span> <span class="p">:</span> <span class="n">eq</span>
                             <span class="p">}</span>
                    <span class="p">})</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fbamod</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">r</span><span class="o">.</span><span class="n">is_exchange</span><span class="p">:</span>
            <span class="n">rBdic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">rBdic</span></div>

<div class="viewcode-block" id="processBiGGchemFormula"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.processBiGGchemFormula">[docs]</a><span class="k">def</span> <span class="nf">processBiGGchemFormula</span><span class="p">(</span><span class="n">fba</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Disambiguates the overloaded BiGG name NAME_CHEMFORMULA into</span>

<span class="sd">     - *species.name* NAME</span>
<span class="sd">     - *species.chemFormula* CHEMFORMULA</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="c1">#print s.name</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp2</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">CF</span> <span class="o">=</span> <span class="n">tmp2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">NM</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">se</span> <span class="ow">in</span> <span class="n">tmp2</span><span class="p">:</span>
                <span class="n">NM</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_&#39;</span> <span class="o">%</span> <span class="n">se</span>
            <span class="n">NM</span> <span class="o">=</span> <span class="n">NM</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#NM = tmp.replace(&#39;_%s&#39; % CF, &#39;&#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">NM</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span>
            <span class="n">CF</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">NM</span><span class="p">,</span> <span class="n">CF</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">tmp2</span>
        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">CF</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">=</span> <span class="n">CF</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">NM</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="processBiGGannotationNote"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.processBiGGannotationNote">[docs]</a><span class="k">def</span> <span class="nf">processBiGGannotationNote</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s1">&#39;note&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the HTML formatted reaction information stored in the BiGG notes field.</span>
<span class="sd">    This function is being deprecated and replaced by `CBTools.processSBMLAnnotationNotes()`</span>

<span class="sd">     - requires an *annotation_key* which contains a BiGG HTML fragment</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Deprecation warning:</span><span class="se">\n</span><span class="s1">CBTools.processBiGGannotationNote() is being replaced with CBTools.processSBMLAnnotationNotes&#39;</span><span class="p">)</span>

    <span class="n">html_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&lt;html:p&gt;.*?&lt;/html:p&gt;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">new_ann</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">annotation_key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_p</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">annotation_key</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
            <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_ann</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span></div>

<div class="viewcode-block" id="processSBMLAnnotationNotes"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.processSBMLAnnotationNotes">[docs]</a><span class="k">def</span> <span class="nf">processSBMLAnnotationNotes</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s1">&#39;note&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse the HTML formatted reaction information stored in the SBML notes field currently</span>
<span class="sd">    processes BiGG and PySCeSCBM style annotations it looks for the the annotation indexed</span>
<span class="sd">    with the *annotation_key*</span>

<span class="sd">     - *annotation_key* [default=&#39;note&#39;] which contains a HTML/XHTML fragment in BiGG/PySCeSCBM format (ignored in L3)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">#if hasattr(fba, &#39;_SBML_LEVEL_&#39;) and fba._SBML_LEVEL_ != None:</span>
        <span class="c1">#print(&#39;\n==================================\nINFO \&quot;CBTools.processSBMLAnnotationNotes()\&quot;:\n&#39;)</span>
        <span class="c1">#print(&#39;This function is now called automatically\nduring model load and can be ignored.&#39;)</span>
        <span class="c1">#print(&#39;==================================\n&#39;)</span>
        <span class="c1">#return</span>

    <span class="n">html_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;.*?&lt;/p&gt;&quot;</span><span class="p">)</span>
    <span class="n">html_span</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;.*?&lt;/span&gt;&quot;</span><span class="p">)</span>
    <span class="n">html_bigg_p</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&lt;html:p&gt;.*?&lt;/html:p&gt;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">annotation_key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">new_ann</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">notes</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getNotes</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">annotation_key</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;&lt;span xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&#39;</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
                <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_p</span><span class="p">,</span> <span class="n">notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_span</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                        <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_bigg_p</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                            <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_p</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                            <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
            <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_ann</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">annotation_key</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">notes</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getNotes</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">notes</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">annotation_key</span><span class="p">)</span>
            <span class="n">new_ann</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;&lt;span xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&#39;</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
                <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_p</span><span class="p">,</span> <span class="n">notes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_span</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
                    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/span&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ps</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                        <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_bigg_p</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/html:p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                            <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hPs</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">html_p</span><span class="p">,</span> <span class="n">notes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">hPs</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">hPs</span><span class="p">:</span>
                        <span class="n">ps</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;/p&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
                            <span class="n">new_ann</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">ps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="p">:</span> <span class="n">ps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()})</span>
            <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">new_ann</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;chemFormula&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;chemFormula&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;FORMULA&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;FORMULA&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkChemFormula</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span><span class="p">):</span>
            <span class="n">s</span><span class="o">.</span><span class="n">chemFormula</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;charge&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;charge&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">chrg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">chrg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid charge: </span><span class="si">{}</span><span class="s1"> defined for species </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chrg</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">or</span> <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;CHARGE&#39;</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span> <span class="ow">and</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="s1">&#39;CHARGE&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">chrg</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;CHARGE&#39;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">chrg</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid charge: </span><span class="si">{}</span><span class="s1"> defined for species </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chrg</span><span class="p">,</span> <span class="n">s</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
                <span class="n">s</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">annotation</span><span class="p">)</span></div>

<div class="viewcode-block" id="processExchangeReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.processExchangeReactions">[docs]</a><span class="k">def</span> <span class="nf">processExchangeReactions</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extract exchange reactions from model using *key* and return:</span>

<span class="sd">     - a dictionary of all exchange reactions without *medium* reactions</span>
<span class="sd">     - a dictionary of *medium* exchange reactions (negative lower bound)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># extract all exchange bounds</span>
    <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fexDic</span> <span class="o">=</span> <span class="n">getExchBoundsDict</span><span class="p">(</span><span class="n">fba</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fexDic</span> <span class="o">=</span> <span class="n">getBoundsDict</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">substring</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>


    <span class="c1"># extract the medium (exchange fluxes that allow uptake)</span>
    <span class="n">MediumAll</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Medium</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fexDic</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fexDic</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;lb&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">MediumAll</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">r</span><span class="p">,</span> <span class="n">fexDic</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;lb&#39;</span><span class="p">],</span> <span class="n">fexDic</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;ub&#39;</span><span class="p">]))</span>
            <span class="n">Medium</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">fexDic</span><span class="p">[</span><span class="n">r</span><span class="p">])</span>
    <span class="c1"># remove medium from bounds dictionary and place in medium dict</span>
    <span class="n">mediumDic</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">Medium</span><span class="p">:</span>
        <span class="n">mediumDic</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">m</span> <span class="p">:</span> <span class="n">fexDic</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">m</span><span class="p">)})</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Medium&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">MediumAll</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mediumDic&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mediumDic</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">r in fexDic&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">mediumDic</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fexDic</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fexDic</span><span class="p">,</span> <span class="n">mediumDic</span></div>

<span class="k">def</span> <span class="nf">generateInputScanReports</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">exDict</span><span class="p">,</span> <span class="n">mediumDict</span><span class="p">,</span> <span class="n">optimal_growth_rates</span><span class="p">,</span> <span class="n">wDir</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">modName</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">sourcefile</span>
    <span class="n">modName</span> <span class="o">+=</span> <span class="n">tag</span>
    <span class="n">rnames</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionNames</span><span class="p">()</span>
    <span class="n">rid</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.medium.csv&#39;</span> <span class="o">%</span> <span class="n">modName</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;J, lb, ub</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">mediumDict</span><span class="p">:</span>
        <span class="n">RN</span> <span class="o">=</span> <span class="n">rnames</span><span class="p">[</span><span class="n">rid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">mediumDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;lb&#39;</span><span class="p">],</span> <span class="n">mediumDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;ub&#39;</span><span class="p">],</span> <span class="n">RN</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.exchange.csv&#39;</span> <span class="o">%</span> <span class="n">modName</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;J, lb, ub</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">exDict</span><span class="p">:</span>
        <span class="n">RN</span> <span class="o">=</span> <span class="n">rnames</span><span class="p">[</span><span class="n">rid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">exDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;lb&#39;</span><span class="p">],</span> <span class="n">exDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;ub&#39;</span><span class="p">],</span> <span class="n">RN</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">F</span> <span class="o">=</span> <span class="n">file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDir</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.optima.csv&#39;</span> <span class="o">%</span> <span class="n">modName</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;J, lb, ub, optimum, &quot;name&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">__DEBUG__</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rnames</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">optimal_growth_rates</span><span class="p">:</span>
        <span class="n">RN</span> <span class="o">=</span> <span class="n">rnames</span><span class="p">[</span><span class="n">rid</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">r</span><span class="p">)]</span>
        <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">exDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;lb&#39;</span><span class="p">],</span> <span class="n">exDict</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s1">&#39;ub&#39;</span><span class="p">],</span> <span class="n">optimal_growth_rates</span><span class="p">[</span><span class="n">r</span><span class="p">],</span> <span class="n">RN</span><span class="p">))</span>
    <span class="n">F</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">F</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">getAllReactionsAssociatedWithGene</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">gene</span><span class="p">,</span> <span class="n">gene_annotation_key</span><span class="o">=</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">GA</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">gene_annotation_key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="n">gene_annotation_key</span>
        <span class="k">elif</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;GENE_ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;GENE_ASSOCIATION&#39;</span>
        <span class="k">if</span> <span class="n">GA</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">gene</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">GA</span><span class="p">]:</span>
                <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">out</span>

<div class="viewcode-block" id="scanForReactionDuplicates"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.scanForReactionDuplicates">[docs]</a><span class="k">def</span> <span class="nf">scanForReactionDuplicates</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ignore_coefficients</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method uses uses a brute force apprach to finding reactions with matching</span>
<span class="sd">    stoichiometry</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">duplicates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">Rref</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">()</span>
        <span class="n">Rref</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">refspecies</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">Rref</span><span class="p">:</span>
            <span class="n">refspecies</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:&#39;</span> <span class="o">%</span> <span class="n">s</span>
        <span class="n">refspecies</span> <span class="o">=</span> <span class="n">refspecies</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">r2</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="n">Rtest</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">getSpeciesIds</span><span class="p">()</span>
            <span class="n">Rtest</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Rref</span> <span class="o">==</span> <span class="n">Rtest</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">r2</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ignore_coefficients</span><span class="p">:</span>
                    <span class="n">go</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">for</span> <span class="n">rgid</span> <span class="ow">in</span> <span class="n">Rtest</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">getReagentWithSpeciesRef</span><span class="p">(</span><span class="n">rgid</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">(</span><span class="n">r2</span><span class="o">.</span><span class="n">getReagentWithSpeciesRef</span><span class="p">(</span><span class="n">rgid</span><span class="p">)</span><span class="o">.</span><span class="n">coefficient</span><span class="p">):</span>
                            <span class="n">go</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="n">go</span><span class="p">:</span>
                        <span class="n">dup</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">id</span><span class="p">,]</span>
                        <span class="n">dup</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                        <span class="n">dup</span> <span class="o">=</span> <span class="n">dup</span><span class="o">+</span><span class="p">[</span><span class="n">refspecies</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">getName</span><span class="p">()]</span>
                        <span class="k">if</span> <span class="n">dup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
                            <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dup</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">id</span><span class="p">,]</span>
                    <span class="n">dup</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                    <span class="n">dup</span> <span class="o">=</span> <span class="n">dup</span><span class="o">+</span><span class="p">[</span><span class="n">refspecies</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">getName</span><span class="p">(),</span> <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">dup</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">getName</span><span class="p">()]</span>
                    <span class="k">if</span> <span class="n">dup</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
                        <span class="n">duplicates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">duplicates</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Found </span><span class="si">%s</span><span class="s1"> pairs of duplicate reactions&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">duplicates</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">duplicates</span></div>

<span class="k">def</span> <span class="nf">countedPause</span><span class="p">(</span><span class="n">Tsec</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Pausing ...   &#39;</span><span class="p">,)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Tsec</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\b\b\b</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\b\b</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;done.&#39;</span><span class="p">))</span>


<div class="viewcode-block" id="addGenesFromAnnotations"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.addGenesFromAnnotations">[docs]</a><span class="k">def</span> <span class="nf">addGenesFromAnnotations</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">annotation_key</span><span class="o">=</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">,</span> <span class="n">gene_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    THIS METHOD IS DERPRECATED PLEASE USE cmod.createGeneAssociationsFromAnnotations()</span>

<span class="sd">    Add genes to the model using the definitions stored in the annotation key</span>

<span class="sd">     - *fba* and fba object</span>
<span class="sd">     - *annotation_key* the annotation dictionary key that holds the gene association for the protein/enzyme</span>
<span class="sd">     - *gene_pattern* deprecated, not needed anymore</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">WARNING: CBTools.addGenesFromAnnotations IS DEPRECATED PLEASE USE cmod.createGeneAssociationsFromAnnotations()</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fba</span><span class="o">.</span><span class="n">createGeneAssociationsFromAnnotations</span><span class="p">(</span><span class="n">annotation_key</span><span class="o">=</span><span class="n">annotation_key</span><span class="p">,</span> <span class="n">replace_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="getModelGenesPerReaction"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.getModelGenesPerReaction">[docs]</a><span class="k">def</span> <span class="nf">getModelGenesPerReaction</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">gene_pattern</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gene_annotation_key</span><span class="o">=</span><span class="s1">&#39;GENE ASSOCIATION&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Parse a BiGG style gene annotation string using default gene_pattern=&#39;(\(\W*\w*\W*\))&#39; or</span>
<span class="sd">    (&lt;any non-alphanum&gt;&lt;any alphanum&gt;&lt;any non-alphanum&gt;)</span>

<span class="sd">    Old eColi specific pattern &#39;(b\w*\W)&#39;</span>

<span class="sd">    It is advisable to use the model methods directly rather than this function</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">react_gene</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1">#gene_re = re.compile(gene_pattern)</span>

    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">GA</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1">##  print r.annotation</span>
        <span class="k">if</span> <span class="n">gene_annotation_key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="n">gene_annotation_key</span>
        <span class="k">elif</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;GENE ASSOCIATION&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;GENE_ASSOCIATION&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;GENE_ASSOCIATION&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;gene_association&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;gene_association&#39;</span>
        <span class="k">elif</span> <span class="s1">&#39;gene association&#39;</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">:</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="s1">&#39;gene association&#39;</span>
        <span class="k">if</span> <span class="n">GA</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">genes</span> <span class="o">=</span> <span class="n">extractGeneIdsFromString</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">annotation</span><span class="p">[</span><span class="n">GA</span><span class="p">])</span>
            <span class="c1">#genes = re.findall(gene_re, r.annotation[GA])</span>
            <span class="c1">#genes = [g.replace(&#39;(&#39;,&#39;&#39;).replace(&#39;)&#39;,&#39;&#39;).strip() for g in genes]</span>
            <span class="c1">##  print r.annotation[&#39;GENE ASSOCIATION&#39;]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">genes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1">##  print &#39;\n&#39;</span>
                <span class="c1">##  print &#39;GA:&#39;, r.annotation[&#39;GENE ASSOCIATION&#39;]</span>
                <span class="c1">##  print r.getId(), genes</span>
                <span class="c1">##  raw_input(&#39;x&#39;)</span>
                <span class="n">genes</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="c1">##  print r.getId(), genes</span>
            <span class="c1">##  raw_input()</span>
            <span class="n">react_gene</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="p">:</span> <span class="n">genes</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">react_gene</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">react_gene</span></div>

<span class="k">def</span> <span class="nf">getReactionsPerGene</span><span class="p">(</span><span class="n">react_gene</span><span class="p">):</span>
    <span class="n">gene_react</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">no_gene</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">R</span> <span class="ow">in</span> <span class="n">react_gene</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">react_gene</span><span class="p">[</span><span class="n">R</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reaction </span><span class="si">{}</span><span class="s1"> has no gene associated with it&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>
            <span class="n">no_gene</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="n">react_gene</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
                <span class="c1">##  GK = G.replace(&#39;(&#39;,&#39;&#39;).replace(&#39;)&#39;,&#39;&#39;).strip()</span>
                <span class="k">if</span> <span class="n">G</span> <span class="ow">in</span> <span class="n">gene_react</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Updating gene </span><span class="si">{}</span><span class="s1"> with reaction </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">R</span><span class="p">))</span>
                    <span class="n">gene_react</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding gene </span><span class="si">{}</span><span class="s1"> to gene_react&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
                    <span class="n">gene_react</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">G</span> <span class="p">:</span> <span class="p">[</span><span class="n">R</span><span class="p">]})</span>
    <span class="n">genes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gene_react</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gene_react</span><span class="p">,</span> <span class="n">genes</span><span class="p">,</span> <span class="n">no_gene</span>

<div class="viewcode-block" id="removeFixedSpeciesReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.removeFixedSpeciesReactions">[docs]</a><span class="k">def</span> <span class="nf">removeFixedSpeciesReactions</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is a hack that removes reactions which only have boundary species as reactants</span>
<span class="sd">    and products. These are typically gene associations encoded in the Manchester style and there</span>
<span class="sd">    is probably a better way of working around this problem ...</span>

<span class="sd">     - *f* an instantiated fba model object</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c_react</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rea</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">lsa</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_boundary</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rea</span><span class="o">.</span><span class="n">reagents</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lsa</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">c_react</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rea</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">c_react</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">deleteReactionAndBounds</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="addFluxAsActiveObjective"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.addFluxAsActiveObjective">[docs]</a><span class="k">def</span> <span class="nf">addFluxAsActiveObjective</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">reaction_id</span><span class="p">,</span> <span class="n">osense</span><span class="p">,</span> <span class="n">coefficient</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a flux as an active objective function</span>

<span class="sd">     - *reaction_id* a string containing a reaction id</span>
<span class="sd">     - *osense* objective sense must be **maximize** or **minimize**</span>
<span class="sd">     - *coefficient* the objective funtion coefficient [default=1]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">osense</span> <span class="o">=</span> <span class="n">osense</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">osense</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span> <span class="n">osense</span> <span class="o">=</span> <span class="s1">&#39;maximize&#39;</span>
    <span class="k">if</span> <span class="n">osense</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span> <span class="n">osense</span> <span class="o">=</span> <span class="s1">&#39;minimize&#39;</span>
    <span class="k">if</span> <span class="n">osense</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;maximise&#39;</span><span class="p">,</span> <span class="s1">&#39;minimise&#39;</span><span class="p">]:</span>
        <span class="n">osense</span> <span class="o">=</span> <span class="n">osense</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;se&#39;</span><span class="p">,</span><span class="s1">&#39;ze&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">osense</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;maximize&#39;</span><span class="p">,</span> <span class="s1">&#39;minimize&#39;</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">osense must be [&#39;maximize&#39;, &#39;minimize&#39;] not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">osense</span>
    <span class="k">assert</span> <span class="n">reaction_id</span> <span class="ow">in</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">reactions</span><span class="p">],</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">%s</span><span class="s1"> is not avalid reaction&#39;</span> <span class="o">%</span> <span class="n">reaction_id</span>
    <span class="n">n_obj</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">reaction_id</span><span class="o">+</span><span class="s1">&#39;_objf&#39;</span><span class="p">,</span><span class="n">osense</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">n_obj</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_flux_obj</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">FluxObjective</span><span class="p">(</span><span class="n">reaction_id</span><span class="o">+</span><span class="s1">&#39;_fluxobj&#39;</span><span class="p">,</span> <span class="n">reaction_id</span><span class="p">,</span> <span class="n">coefficient</span><span class="p">)</span>
    <span class="n">n_obj</span><span class="o">.</span><span class="n">addFluxObjective</span><span class="p">(</span><span class="n">n_flux_obj</span><span class="p">)</span></div>


<div class="viewcode-block" id="checkReactionBalanceElemental"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.checkReactionBalanceElemental">[docs]</a><span class="k">def</span> <span class="nf">checkReactionBalanceElemental</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Rid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zero_tol</span><span class="o">=</span><span class="mf">1.0e-12</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the reaction is balanced using the chemical formula</span>

<span class="sd">     - *f* the FBA object</span>
<span class="sd">     - *Rid* [default = None] the reaction to check, defaults to all</span>
<span class="sd">     - *zero_tol* [default=1.0e-12] the floating point zero used for elemental balancing</span>

<span class="sd">    This function is derived from the code found here: http://pyparsing.wikispaces.com/file/view/chemicalFormulas.py</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">HAVE_PYPARSING</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">PyParsing needs to be installed for this method&#39;</span>
    <span class="k">if</span> <span class="n">Rid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">Rid</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Rid</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rid</span> <span class="o">=</span> <span class="p">[</span><span class="n">Rid</span><span class="p">]</span>
    <span class="n">ROUT</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">RCHARGE</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">Rid</span><span class="p">:</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
        <span class="n">reagents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">netcharge</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">R</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
            <span class="n">CF</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span><span class="o">.</span><span class="n">chemFormula</span>
            <span class="n">chrg</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span><span class="o">.</span><span class="n">charge</span>
            <span class="k">if</span> <span class="n">CF</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="c1">#print rid, rr.getId(), CF</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">CFP</span> <span class="o">=</span> <span class="n">pp_chemicalFormula</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">CF</span><span class="p">)</span>
                    <span class="n">R2</span> <span class="o">=</span> <span class="p">[(</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">CFP</span><span class="p">]</span>
                    <span class="c1">#print R2</span>
                    <span class="c1"># note this uses a net stoichiometry approach with signed coefficients</span>
                    <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">,</span> <span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="n">R2</span><span class="p">])</span>
                <span class="k">except</span> <span class="n">pyparsing</span><span class="o">.</span><span class="n">ParseException</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Invalid Chemical Formula (</span><span class="si">{}</span><span class="s1">): </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span> <span class="n">CF</span><span class="p">))</span>
                    <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">,</span> <span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># note this uses a net stoichiometry approach with signed coefficients</span>
                <span class="n">reagents</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">rr</span><span class="o">.</span><span class="n">species_ref</span><span class="p">,</span> <span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span><span class="p">,</span> <span class="n">CF</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">chrg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">netcharge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">netcharge</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chrg</span><span class="p">)</span><span class="o">*</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">netcharge</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">chrg</span><span class="p">)</span><span class="o">*</span><span class="n">rr</span><span class="o">.</span><span class="n">coefficient</span>
        <span class="c1"># if after all this we still do not have a charge make it all zero</span>
        <span class="n">RCHARGE</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span> <span class="o">=</span> <span class="n">netcharge</span>
        <span class="n">ROUT</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span> <span class="o">=</span> <span class="n">reagents</span>
    <span class="n">Rres</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">R</span> <span class="ow">in</span> <span class="n">ROUT</span><span class="p">:</span>
        <span class="n">Ed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">rr</span> <span class="ow">in</span> <span class="n">ROUT</span><span class="p">[</span><span class="n">R</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">rr</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Ed</span><span class="p">:</span>
                        <span class="n">Ed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">Ed</span><span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Ed</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">rr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span><span class="c1"># print(&#39;Invalid or no chemical formula defined for reagent: {}&#39;.format(rr[0]))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ed</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">CBAL</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">EBAL</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">CBAL</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">EBAL</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Ed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ed</span><span class="p">[</span><span class="n">e</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">zero_tol</span><span class="p">:</span>
                <span class="n">EBAL</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">RCHARGE</span><span class="p">[</span><span class="n">R</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">RCHARGE</span><span class="p">[</span><span class="n">R</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">zero_tol</span><span class="p">:</span>
                <span class="n">CBAL</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">Rres</span><span class="o">.</span><span class="n">update</span><span class="p">({</span> <span class="n">R</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span> <span class="p">:</span> <span class="n">R</span><span class="p">,</span>
                            <span class="s1">&#39;charge_balanced&#39;</span> <span class="p">:</span> <span class="n">CBAL</span><span class="p">,</span>
                            <span class="s1">&#39;element_balanced&#39;</span> <span class="p">:</span> <span class="n">EBAL</span><span class="p">,</span>
                            <span class="s1">&#39;elements&#39;</span> <span class="p">:</span> <span class="n">Ed</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
                            <span class="s1">&#39;charge&#39;</span> <span class="p">:</span> <span class="n">RCHARGE</span><span class="p">[</span><span class="n">R</span><span class="p">],</span>
                            <span class="s1">&#39;stuff&#39;</span> <span class="p">:</span> <span class="n">ROUT</span><span class="p">[</span><span class="n">R</span><span class="p">]}})</span>
        <span class="k">if</span> <span class="n">CBAL</span> <span class="ow">and</span> <span class="n">EBAL</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">is_balanced</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="o">.</span><span class="n">is_balanced</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">Rres</span></div>

<div class="viewcode-block" id="scanForUnbalancedReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.scanForUnbalancedReactions">[docs]</a><span class="k">def</span> <span class="nf">scanForUnbalancedReactions</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan a model for unbalanced reactions, returns a tuple of dictionaries balanced and unbalanced:</span>

<span class="sd">     - *f* an FBA model instance</span>
<span class="sd">     - *output* [default=&#39;all&#39;] can be one of [&#39;all&#39;,&#39;charge&#39;,&#39;element&#39;]</span>
<span class="sd">     - *charge* return all charge **un** balanced reactions</span>
<span class="sd">     - *element* return all element **un** balanced reactions</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bcheck</span> <span class="o">=</span> <span class="n">checkReactionBalanceElemental</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">badD</span> <span class="o">=</span> <span class="n">bcheck</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">all_balanced</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">charge_balanced</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">element_balanced</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bcheck</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">bcheck</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;charge_balanced&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">bcheck</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;element_balanced&#39;</span><span class="p">]:</span>
            <span class="n">all_balanced</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">b</span> <span class="p">:</span> <span class="n">badD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">b</span><span class="p">)})</span>
        <span class="k">elif</span> <span class="n">bcheck</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;charge_balanced&#39;</span><span class="p">]:</span>
            <span class="n">charge_balanced</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">b</span> <span class="p">:</span> <span class="n">badD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">b</span><span class="p">)})</span>
        <span class="k">elif</span> <span class="n">bcheck</span><span class="p">[</span><span class="n">b</span><span class="p">][</span><span class="s1">&#39;element_balanced&#39;</span><span class="p">]:</span>
            <span class="n">element_balanced</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">b</span> <span class="p">:</span> <span class="n">badD</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">b</span><span class="p">)})</span>
    <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;charge&#39;</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_balanced</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">output</span> <span class="o">==</span> <span class="s1">&#39;element&#39;</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">charge_balanced</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">element_balanced</span><span class="p">)</span>
        <span class="n">out</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">charge_balanced</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bcheck</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">badD</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="createZipArchive"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.createZipArchive">[docs]</a><span class="k">def</span> <span class="nf">createZipArchive</span><span class="p">(</span><span class="n">zipname</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">move</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a zip archive which contains one or more files</span>

<span class="sd">     - *zipname* the name of the zip archive to create (fully qualified)</span>
<span class="sd">     - *files* either a valid filename or a list of filenames (fully qualified)</span>
<span class="sd">     - *move* [default=False] attempt to delete input files after zip-archive creation</span>
<span class="sd">     - *compression* [default=&#39;normal&#39;] normal zip compression, set as None for no compression only store files (zlib not required)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">compression</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_STORED</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">compression</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZIP_DEFLATED</span>

    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">zipname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">compression</span><span class="o">=</span><span class="n">compression</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f_</span><span class="p">),</span> <span class="s1">&#39;ERROR: file </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> does not exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">f_</span><span class="p">,</span> <span class="n">arcname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f_</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">move</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: </span><span class="si">{}</span><span class="s1"> input file(s) moved to archive </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="n">zipname</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">INFO: zip-archive </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> created.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zipname</span><span class="p">))</span></div>

<div class="viewcode-block" id="checkExchangeReactions"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.checkExchangeReactions">[docs]</a><span class="k">def</span> <span class="nf">checkExchangeReactions</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">autocorrect</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scan all reactions for exchange reactions (reactions containing a boundary species), return a list of</span>
<span class="sd">    inconsistent reactions or correct automatically.</span>

<span class="sd">    - *fba* a CBMPy model</span>
<span class="sd">    - *autocorrect* [default=True] correctly set the &quot;is_exchange&quot; attribute on a reaction</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">badR</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">has_fixed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="kc">True</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fba</span><span class="o">.</span><span class="n">getSpecies</span><span class="p">(</span><span class="n">rr_</span><span class="o">.</span><span class="n">species_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_boundary</span> <span class="k">for</span> <span class="n">rr_</span> <span class="ow">in</span> <span class="n">r_</span><span class="o">.</span><span class="n">reagents</span><span class="p">]:</span>
            <span class="n">has_fixed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">r_</span><span class="o">.</span><span class="n">is_exchange</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_fixed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: reaction </span><span class="si">{}</span><span class="s1"> is labelled as an exchange reaction but has no fixed reagents.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">autocorrect</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: is_exchange reaction attribute corrected&#39;</span><span class="p">)</span>
                <span class="n">r_</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="n">has_fixed</span>
            <span class="n">badR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">r_</span><span class="o">.</span><span class="n">is_exchange</span> <span class="ow">and</span> <span class="n">has_fixed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: reaction </span><span class="si">{}</span><span class="s1"> is not labelled as an exchange reaction but contains a fixed reagent.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">autocorrect</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: is_exchange reaction attribute corrected&#39;</span><span class="p">)</span>
                <span class="n">r_</span><span class="o">.</span><span class="n">is_exchange</span> <span class="o">=</span> <span class="n">has_fixed</span>
            <span class="n">badR</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">badR</span></div>


<div class="viewcode-block" id="checkIds"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.checkIds">[docs]</a><span class="k">def</span> <span class="nf">checkIds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Checks the id&#39;s of the specified model attributes to see if the name is legal and if there are duplicates.</span>
<span class="sd">    Returns a list of items with errors.</span>

<span class="sd">    - *fba* a CBMPy model instance</span>
<span class="sd">    - *items* [default=&#39;all&#39;] &#39;all&#39; means &#39;species,reactions,flux_bounds,objectives&#39; of which one or more can be specified</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">items</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="s1">&#39;species,reactions,flux_bounds,objectives&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">items</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>


    <span class="k">for</span> <span class="n">i_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">items</span><span class="p">[</span><span class="n">i_</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: bad descriptor </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> removing from input list&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i_</span><span class="p">)))</span>

    <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">iddump</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i_</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
        <span class="n">output</span><span class="p">[</span><span class="n">i_</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ITEMS</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="n">i_</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">I_</span> <span class="ow">in</span> <span class="n">ITEMS</span><span class="p">:</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="n">I_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Id</span> <span class="ow">in</span> <span class="n">iddump</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: duplicate </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> id: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i_</span><span class="p">,</span> <span class="n">Id</span><span class="p">))</span>
                <span class="n">output</span><span class="p">[</span><span class="n">i_</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I_</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iddump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i_</span> <span class="o">==</span> <span class="s1">&#39;reactions&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;reagents&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;reagents&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">rr_</span> <span class="ow">in</span> <span class="n">I_</span><span class="o">.</span><span class="n">reagents</span><span class="p">:</span>
                    <span class="n">rrid</span> <span class="o">=</span> <span class="n">rr_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">rrid</span> <span class="ow">in</span> <span class="n">iddump</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: duplicate </span><span class="se">\&quot;</span><span class="s1">reagent</span><span class="se">\&quot;</span><span class="s1"> id: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rrid</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">rr_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;reagents&#39;</span><span class="p">]:</span>
                            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;reagents&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rr_</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iddump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rrid</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i_</span> <span class="o">==</span> <span class="s1">&#39;objectives&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;fluxObjectives&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                    <span class="n">output</span><span class="p">[</span><span class="s1">&#39;fluxObjectives&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">fo_</span> <span class="ow">in</span> <span class="n">I_</span><span class="o">.</span><span class="n">fluxObjectives</span><span class="p">:</span>
                    <span class="n">foid</span> <span class="o">=</span> <span class="n">fo_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">foid</span> <span class="ow">in</span> <span class="n">iddump</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;INFO: duplicate </span><span class="se">\&quot;</span><span class="s1">fluxObjective</span><span class="se">\&quot;</span><span class="s1"> id: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">foid</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">fo_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s1">&#39;fluxObjectives&#39;</span><span class="p">]:</span>
                            <span class="n">output</span><span class="p">[</span><span class="s1">&#39;fluxObjectives&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fo_</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">iddump</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">foid</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">WARNING: no valid object descriptors found, please check your function call!&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output</span></div>


<div class="viewcode-block" id="checkFluxBoundConsistency"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.checkFluxBoundConsistency">[docs]</a><span class="k">def</span> <span class="nf">checkFluxBoundConsistency</span><span class="p">(</span><span class="n">fba</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check flux bound consistency checks for multiply defined bounds, bounds without a reaction, inconsistent bounds with respect to each other</span>
<span class="sd">    and reaction reversbility. Returns a dictionary of bounds/reactions where errors occur.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dupIDs</span> <span class="o">=</span> <span class="n">checkIds</span><span class="p">(</span><span class="n">fba</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="s1">&#39;flux_bounds&#39;</span><span class="p">)[</span><span class="s1">&#39;flux_bounds&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dupIDs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">ERROR: </span><span class="si">{}</span><span class="s1"> duplicate flux_bound Id</span><span class="se">\&#39;</span><span class="s1">s detected!&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dupIDs</span><span class="p">)))</span>

    <span class="n">LB</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">UB</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">EB</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">eMB</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lower&#39;</span> <span class="p">:</span> <span class="p">{},</span>
           <span class="s1">&#39;upper&#39;</span> <span class="p">:</span> <span class="p">{},</span>
           <span class="s1">&#39;equality&#39;</span> <span class="p">:</span> <span class="p">{}</span>
           <span class="p">}</span>

    <span class="n">noreaction</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">fb</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="n">raw_type</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">is_bound</span>
        <span class="n">get_type</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">getType</span><span class="p">()</span>
        <span class="n">RID</span> <span class="o">=</span> <span class="n">fb</span><span class="o">.</span><span class="n">getReactionId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">raw_type</span> <span class="o">!=</span> <span class="n">get_type</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: incorrect bound type for operation: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> old </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1"> --&gt; </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fb</span><span class="o">.</span><span class="n">operation</span><span class="p">,</span> <span class="n">raw_type</span><span class="p">,</span> <span class="n">get_type</span><span class="p">))</span>

        <span class="k">if</span>  <span class="n">get_type</span> <span class="o">==</span> <span class="s1">&#39;lower&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">LB</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR multiple LOWER bounds defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RID</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">fb</span><span class="p">]</span>
            <span class="n">LB</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="n">fb</span>
        <span class="k">if</span>  <span class="n">get_type</span> <span class="o">==</span> <span class="s1">&#39;upper&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">UB</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR multiple UPPER bounds defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RID</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">fb</span><span class="p">]</span>
            <span class="n">UB</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="n">fb</span>
        <span class="k">if</span>  <span class="n">get_type</span> <span class="o">==</span> <span class="s1">&#39;equality&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">EB</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR multiple EQUAL bounds defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">RID</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">RID</span> <span class="ow">in</span> <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">]:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">][</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">fb</span><span class="p">]</span>

            <span class="n">EB</span><span class="p">[</span><span class="n">RID</span><span class="p">]</span> <span class="o">=</span> <span class="n">fb</span>
        <span class="k">if</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">RID</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">noreaction</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fb</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">mb_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">][</span><span class="n">mb_</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mb_</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">mb_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">][</span><span class="n">mb_</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mb_</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">mb_</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">][</span><span class="n">mb_</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">eMB</span><span class="p">[</span><span class="s1">&#39;equality&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">mb_</span><span class="p">)</span>

    <span class="n">undefined</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;no_upper&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                 <span class="s1">&#39;no_lower&#39;</span> <span class="p">:</span> <span class="p">[],</span>
                 <span class="s1">&#39;no_upper_lower&#39;</span> <span class="p">:</span> <span class="p">[]</span>
                 <span class="p">}</span>

    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReactionIds</span><span class="p">():</span>
        <span class="n">LBdef</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">UBdef</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">r_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">EB</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">r_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">LB</span><span class="p">:</span>
                <span class="n">LBdef</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">r_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">UB</span><span class="p">:</span>
                <span class="n">UBdef</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">LBdef</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">UBdef</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: No bounds defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="p">))</span>
            <span class="n">undefined</span><span class="p">[</span><span class="s1">&#39;no_upper_lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">LBdef</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: No LOWER BOUND defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="p">))</span>
                <span class="n">undefined</span><span class="p">[</span><span class="s1">&#39;no_lower&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">UBdef</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: No UPPER BOUND defined for reaction: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_</span><span class="p">))</span>
                <span class="n">undefined</span><span class="p">[</span><span class="s1">&#39;no_upper&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r_</span><span class="p">)</span>

    <span class="n">errors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;eq+lb&#39;</span> <span class="p">:</span> <span class="p">[],</span>
              <span class="s1">&#39;eq+ub&#39;</span> <span class="p">:</span> <span class="p">[],</span>
              <span class="s1">&#39;duplicate_ids&#39;</span> <span class="p">:</span> <span class="n">dupIDs</span><span class="p">,</span>
              <span class="s1">&#39;multiple_defines&#39;</span> <span class="p">:</span> <span class="n">eMB</span><span class="p">,</span>
              <span class="s1">&#39;lb&gt;ub&#39;</span> <span class="p">:</span> <span class="p">[],</span>
              <span class="s1">&#39;undefined&#39;</span> <span class="p">:</span> <span class="n">undefined</span><span class="p">,</span>
              <span class="s1">&#39;rev_contradict&#39;</span> <span class="p">:</span> <span class="p">[],</span>
              <span class="s1">&#39;no_reaction&#39;</span> <span class="p">:</span> <span class="n">noreaction</span>
              <span class="p">}</span>

    <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">EB</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">LB</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">[</span><span class="s1">&#39;eq+lb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">EB</span><span class="p">[</span><span class="n">k_</span><span class="p">],</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">UB</span><span class="p">:</span>
            <span class="n">errors</span><span class="p">[</span><span class="s1">&#39;eq+ub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">EB</span><span class="p">[</span><span class="n">k_</span><span class="p">],</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]))</span>

    <span class="n">checked</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">LB</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">UB</span> <span class="ow">and</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">checked</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Reaction </span><span class="si">{}</span><span class="s1"> has lower bound (</span><span class="si">{}</span><span class="s1">) larger than upper bound (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k_</span><span class="p">,</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
                <span class="n">errors</span><span class="p">[</span><span class="s1">&#39;lb&gt;ub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">],</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]))</span>
            <span class="n">checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>
        <span class="n">assR</span> <span class="o">=</span> <span class="n">fba</span><span class="o">.</span><span class="n">getReaction</span><span class="p">(</span><span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getReactionId</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">assR</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assR</span><span class="o">.</span><span class="n">reversible</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Reaction </span><span class="si">{}</span><span class="s1"> is marked as irreversible but has a negative lower bound (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">assR</span><span class="o">.</span><span class="n">getId</span><span class="p">(),</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
                    <span class="n">errors</span><span class="p">[</span><span class="s1">&#39;rev_contradict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">assR</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">assR</span>

    <span class="k">for</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">UB</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">k_</span> <span class="ow">in</span> <span class="n">LB</span> <span class="ow">and</span> <span class="n">k_</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">checked</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ERROR: Reaction </span><span class="si">{}</span><span class="s1"> has lower bound (</span><span class="si">{}</span><span class="s1">) larger than upper bound (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k_</span><span class="p">,</span> <span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">(),</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]</span><span class="o">.</span><span class="n">getValue</span><span class="p">()))</span>
                <span class="n">errors</span><span class="p">[</span><span class="s1">&#39;lb&gt;ub&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">LB</span><span class="p">[</span><span class="n">k_</span><span class="p">],</span> <span class="n">UB</span><span class="p">[</span><span class="n">k_</span><span class="p">]))</span>
            <span class="n">checked</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">errors</span></div>

<div class="viewcode-block" id="roundOffWithSense"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.roundOffWithSense">[docs]</a><span class="k">def</span> <span class="nf">roundOffWithSense</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">osense</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round of a value in a way that takes into consideration the sense of the operation that generated it</span>

<span class="sd">     - *val* the value</span>
<span class="sd">     - *osense* [default=&#39;max&#39;] the sense</span>
<span class="sd">     - *tol* [default=1e-8] the tolerance of the roundoff factor</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">osense</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;minimize&#39;</span><span class="p">,</span> <span class="s1">&#39;minimise&#39;</span><span class="p">]:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">tol</span><span class="p">)</span><span class="o">*</span><span class="n">tol</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">tol</span><span class="p">)</span><span class="o">*</span><span class="n">tol</span>
    <span class="k">return</span> <span class="n">val</span></div>

<div class="viewcode-block" id="merge2Models"><a class="viewcode-back" href="../../modules_doc.html#cbmpy.CBTools.merge2Models">[docs]</a><span class="k">def</span> <span class="nf">merge2Models</span><span class="p">(</span><span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">ignore</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ignore_duplicate_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge 2 models, this method does a raw merge of model 2 into model 1 without any model checking.</span>
<span class="sd">    Component id&#39;s in ignore are ignored in both models and the first objective of model 1 is arbitrarily</span>
<span class="sd">    set as active. Compartments are also merged and a new &quot;OuterMerge&quot; compartment is also created.</span>

<span class="sd">    In all cases duplicate id&#39;s are tracked and ignored, essentially using the object id encountered first -</span>
<span class="sd">    usually that of model 1. Duplicate checking can be disabled by setting the *ignore_duplicate_ids* flag.</span>

<span class="sd">    - *m1* model 1</span>
<span class="sd">    - *m2* model 2</span>
<span class="sd">    - *ignore* [[]] do not merge these id&#39;s</span>
<span class="sd">    - *ignore_duplicate_ids* [False] default behaviour that can be enabled</span>

<span class="sd">    In development: merging genes and gpr&#39;s.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ignore</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ignore</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">out</span> <span class="o">=</span> <span class="n">CBModel</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="o">+</span> <span class="n">m2</span><span class="o">.</span><span class="n">getId</span><span class="p">())</span>
    <span class="n">out</span><span class="o">.</span><span class="n">setName</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">getName</span><span class="p">()</span> <span class="o">+</span> <span class="n">m2</span><span class="o">.</span><span class="n">getName</span><span class="p">())</span>
    <span class="n">out</span><span class="o">.</span><span class="n">createCompartment</span><span class="p">(</span><span class="s1">&#39;OuterMerge&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dimensions</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">idstore</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x_</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">compartments</span><span class="o">+</span><span class="n">m2</span><span class="o">.</span><span class="n">compartments</span><span class="p">:</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">x_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_duplicate_ids</span> <span class="ow">or</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idstore</span><span class="p">:</span>
                <span class="n">idstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">addCompartment</span><span class="p">(</span><span class="n">x_</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">species</span><span class="o">+</span><span class="n">m2</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">s_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_duplicate_ids</span> <span class="ow">or</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idstore</span><span class="p">:</span>
                <span class="n">idstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">addSpecies</span><span class="p">(</span><span class="n">s_</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping duplicate id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping ignored id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">r_</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">reactions</span><span class="o">+</span><span class="n">m2</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">r_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_duplicate_ids</span> <span class="ow">or</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idstore</span><span class="p">:</span>
                <span class="n">idstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">addReaction</span><span class="p">(</span><span class="n">r_</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">create_default_bounds</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping duplicate id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping ignored id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">f_</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">flux_bounds</span><span class="o">+</span><span class="n">m2</span><span class="o">.</span><span class="n">flux_bounds</span><span class="p">:</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">f_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">f_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_duplicate_ids</span> <span class="ow">or</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idstore</span><span class="p">:</span>
                <span class="n">idstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                <span class="n">out</span><span class="o">.</span><span class="n">addFluxBound</span><span class="p">(</span><span class="n">f_</span><span class="o">.</span><span class="n">clone</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping duplicate id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping ignored id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
    <span class="n">GO</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">o_</span> <span class="ow">in</span> <span class="n">m1</span><span class="o">.</span><span class="n">objectives</span><span class="o">+</span><span class="n">m2</span><span class="o">.</span><span class="n">objectives</span><span class="p">:</span>
        <span class="n">sid</span> <span class="o">=</span> <span class="n">o_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">o_</span><span class="o">.</span><span class="n">getId</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_duplicate_ids</span> <span class="ow">or</span> <span class="n">sid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idstore</span><span class="p">:</span>
                <span class="n">idstore</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">GO</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o_</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">GO</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">addObjective</span><span class="p">(</span><span class="n">o_</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping duplicate id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Skipping ignored id: </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sid</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Added </span><span class="si">{}</span><span class="s1"> components to merged model&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">idstore</span><span class="p">)))</span>
    <span class="n">idstore</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">out</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../cbmpy.html">
              <img class="logo" src="../../_static/pysces_cbm1_head.jpg" alt="Logo"/>
            </a></p><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../cbmpy.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2010-2018, Brett G. Olivier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>